(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"9gde":function(e,t,r){"use strict";r.r(t),r.d(t,"SuppliersModule",(function(){return ee}));var o=r("ojfV"),s=r("2xuv"),i=r("+PXZ"),n=r("3lET"),a=r("CSBE"),c=r("ofXK"),l=r("MutI"),d=r("NFeN"),b=r("qFsG"),u=r("0IaG"),p=r("FKr1"),m=r("d3UM"),h=r("bTqV"),f=r("/t3+"),g=r("Q92/"),y=r("kmnG"),I=r("NwyA"),C=r("bv9b"),V=r("2ChS"),v=r("mrSG"),U=r("+bmA"),w=r("KK9o"),O=r("IQQo"),q=r("HqD8"),P=r("nFDT"),k=r("jDep"),B=r("fXoL"),x=r("d3yR"),D=r("9ZKQ"),M=r("ZVi7"),N=r("tyNb"),Q=r("wPrS"),z=r("sC6t");function A(e,t){1&e&&B.Qb(0,"mat-progress-bar",8)}function T(e,t){if(1&e){const e=B.Wb();B.Vb(0,"mat-list-item",9),B.dc("click",(function(){B.uc(e);const r=t.$implicit;return B.hc().options(r)})),B.Vb(1,"h3"),B.Bc(2),B.Ub(),B.Ub()}if(2&e){const e=t.$implicit;B.Cb(2),B.Dc(" ",e.description," ")}}const _=function(e){return{mode:"add",storeId:e}};let j=(()=>{class e{constructor(e,t,r,o,s,i,n){this.menu=e,this.toast=t,this.sheet=r,this.dialog=o,this.suppliers=s,this.route=i,this.router=n,this.filter="",this.subscriptions={}}list(){return Object(v.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.suppliers.list({filter:["role","icon","storeId","supplierId","description"]});this.suppliers.data=e.ok?e.result:[],this.loading=!1}))}options(e){return Object(v.a)(this,void 0,void 0,(function*(){const t=yield this.sheet.open(k.a,{data:{items:[{role:e.role,icon:"edit",scope:3,title:"Edit",option:1},{role:e.role,icon:"file_copy",scope:3,title:"Copy",option:2},{role:e.role,icon:"share",scope:4,title:"Share",option:3},{role:e.role,icon:"people",scope:4,title:"Subscribers",option:4},{role:e.role,icon:"remove",scope:1,color:"warn",title:"Unsubscribe",option:5},{role:e.role,icon:"delete",scope:5,color:"warn",title:"Delete",option:6}],title:e.description}});yield t.afterDismissed().subscribe(t=>Object(v.a)(this,void 0,void 0,(function*(){if(t)switch(t){case 1:this.router.navigate(["/suppliers","editor"],{queryParams:{mode:"update",storeId:this.storeId,supplierId:e.supplierId}});break;case 2:this.router.navigate(["/suppliers","editor"],{queryParams:{mode:"copy",storeId:this.storeId,supplierId:e.supplierId}});break;case 3:const t=yield this.dialog.open(U.a,{panelClass:"share-dialog"});yield t.afterClosed().subscribe(t=>Object(v.a)(this,void 0,void 0,(function*(){if(t){this.loading=!0;const r=yield this.suppliers.share({role:t.role,email:t.email,storeId:this.storeId,supplierId:e.supplierId});r.ok?this.toast.success("user was shared!"):this.toast.error(r.error.message),this.loading=!1}})));break;case 4:this.dialog.open(P.a,{data:{id:e.supplierId,type:"supplier",storeId:this.storeId,service:this.suppliers},panelClass:"subscribers-dialog"});break;case 5:const r=yield this.dialog.open(q.a,{panelClass:"unsubscribe-dialog"});yield r.afterClosed().subscribe(t=>Object(v.a)(this,void 0,void 0,(function*(){if(t){this.loading=!0;const t=yield this.suppliers.unsubscribe({storeId:this.storeId,supplierId:e.supplierId});t.ok?this.toast.success("you were unsubscribed from supplier!"):this.toast.error(t.error.message),this.loading=!1}})));break;case 6:const o=yield this.dialog.open(w.a,{panelClass:"delete-dialog"});yield o.afterClosed().subscribe(t=>Object(v.a)(this,void 0,void 0,(function*(){if(t){this.loading=!0;const t=yield this.suppliers.delete({storeId:this.storeId,supplierId:e.supplierId});t.ok?this.toast.success("supplier was deleted!"):this.toast.error(t.error.message),this.loading=!1}})))}})))}))}ngOnInit(){this.subscriptions.route=this.route.queryParams.subscribe(e=>{void 0!==e.storeId&&null!=e.storeId&&""!=e.storeId?(this.storeId=e.storeId,this.list()):this.router.navigate(["/stores"])}),this.subscriptions.search=this.search.change.subscribe(e=>{this.filter=e})}ngOnDestroy(){this.subscriptions.route.unsubscribe(),this.subscriptions.search.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(B.Pb(x.a),B.Pb(D.a),B.Pb(V.b),B.Pb(u.b),B.Pb(M.a),B.Pb(N.a),B.Pb(N.c))},e.\u0275cmp=B.Jb({type:e,selectors:[["app-suppliers-page"]],viewQuery:function(e,t){var r;1&e&&B.yc(O.a,!0),2&e&&B.rc(r=B.ec())&&(t.search=r.first)},decls:16,vars:12,consts:[["color","primary"],["mat-icon-button","",1,"menu-toggle",3,"click"],[1,"page-title","spacer"],["placeholder","search suppliers"],["mat-icon-button","","routerLink","editor",3,"queryParams"],["mode","indeterminate",4,"ngIf"],[1,"page-body"],["matRipple","",3,"click",4,"ngFor","ngForOf"],["mode","indeterminate"],["matRipple","",3,"click"]],template:function(e,t){1&e&&(B.Vb(0,"mat-toolbar",0),B.Vb(1,"button",1),B.dc("click",(function(){return t.menu.toggle()})),B.Vb(2,"mat-icon"),B.Bc(3," menu "),B.Ub(),B.Ub(),B.Vb(4,"label",2),B.Bc(5," suppliers "),B.Ub(),B.Qb(6,"search",3),B.Vb(7,"button",4),B.Vb(8,"mat-icon"),B.Bc(9," add "),B.Ub(),B.Ub(),B.Ub(),B.Ac(10,A,1,0,"mat-progress-bar",5),B.Vb(11,"div",6),B.Vb(12,"mat-list"),B.Ac(13,T,3,1,"mat-list-item",7),B.ic(14,"filterBy"),B.ic(15,"orderBy"),B.Ub(),B.Ub()),2&e&&(B.Cb(7),B.oc("queryParams",B.qc(10,_,t.storeId)),B.Cb(3),B.oc("ngIf",t.loading),B.Cb(3),B.oc("ngForOf",B.lc(14,3,B.kc(15,7,t.suppliers.data,"description"),"description",t.filter)))},directives:[f.a,h.a,d.a,O.a,N.d,c.l,l.a,c.k,C.a,l.b,p.o],pipes:[Q.a,z.a],styles:["mat-list[_ngcontent-%COMP%]{padding:0!important}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{flex:1 auto;cursor:pointer;display:flex;align-items:center;border-bottom:1px solid #e0e0e0;flex-direction:row}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:14px;text-transform:uppercase}"]}),e})();var S=r("3Pt+"),F=r("5mtf"),G=r("dWDE");function K(e,t){1&e&&B.Qb(0,"mat-progress-bar",20)}function R(e,t){if(1&e&&(B.Vb(0,"mat-error"),B.Bc(1),B.Ub()),2&e){const e=B.hc();B.Cb(1),B.Dc(" ",e.errors.description," ")}}function E(e,t){if(1&e&&(B.Vb(0,"mat-error"),B.Bc(1),B.Ub()),2&e){const e=B.hc();B.Cb(1),B.Dc(" ",e.errors.organizationOnly," ")}}function J(e,t){if(1&e&&(B.Vb(0,"mat-error"),B.Bc(1),B.Ub()),2&e){const e=B.hc();B.Cb(1),B.Dc(" ",e.errors.address.street," ")}}function X(e,t){if(1&e&&(B.Vb(0,"mat-error"),B.Bc(1),B.Ub()),2&e){const e=B.hc();B.Cb(1),B.Dc(" ",e.errors.address.suburb," ")}}function Z(e,t){if(1&e&&(B.Vb(0,"mat-error"),B.Bc(1),B.Ub()),2&e){const e=B.hc();B.Cb(1),B.Dc(" ",e.errors.address.cityTown," ")}}function L(e,t){if(1&e&&(B.Vb(0,"mat-error"),B.Bc(1),B.Ub()),2&e){const e=B.hc();B.Cb(1),B.Dc(" ",e.errors.address.postalCode," ")}}function W(e,t){if(1&e&&(B.Vb(0,"mat-error"),B.Bc(1),B.Ub()),2&e){const e=B.hc();B.Cb(1),B.Dc(" ",e.errors.email," ")}}function $(e,t){if(1&e&&(B.Vb(0,"mat-error"),B.Bc(1),B.Ub()),2&e){const e=B.hc();B.Cb(1),B.Dc(" ",e.errors.phone," ")}}const H=[{path:"",component:j},{path:"editor",component:(()=>{class e{constructor(e,t,r,o,s){this.route=e,this.toast=t,this.service=r,this.history=o,this.formerror=s,this.form=new S.d({address:new S.d({street:new S.b("",[S.q.required]),suburb:new S.b("",[S.q.required]),cityTown:new S.b("",[S.q.required]),postalCode:new S.b("",[S.q.required])}),phone:new S.b("",[S.q.required]),email:new S.b("",[S.q.required,S.q.email]),description:new S.b("",[S.q.required]),organizationOnly:new S.b(1,[S.q.required])}),this.errors={address:{street:"",suburb:"",cityTown:"",postalCode:""},phone:"",email:"",description:"",organizationOnly:""},this.subscriptions={}}get(){return Object(v.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.service.get({filter:["role","phone","email","address","description","organizationOnly"],storeId:this.storeId,supplierId:this.supplierId});if(e.ok){e.result.role<3&&this.history.back();const t=this.form.controls.address;t.controls.street.setValue(e.result.address.street),t.controls.suburb.setValue(e.result.address.suburb),t.controls.cityTown.setValue(e.result.address.cityTown),t.controls.postalCode.setValue(e.result.address.postalCode),this.form.controls.phone.setValue(e.result.phone),this.form.controls.email.setValue(e.result.email),this.form.controls.description.setValue(e.result.description),this.form.controls.organizationOnly.setValue(e.result.organizationOnly)}else this.toast.error(e.error.message);this.loading=!1}))}submit(){return Object(v.a)(this,void 0,void 0,(function*(){this.loading=!0;let e=this.mode;"copy"==e&&(e="add",delete this.supplierId);const t=yield this.service[e]({phone:this.form.value.phone,email:this.form.value.email,address:this.form.value.address,storeId:this.storeId,supplierId:this.supplierId,description:this.form.value.description,organizationOnly:this.form.value.organizationOnly});t.ok?(this.toast.success("supplier was updated!"),this.history.back()):this.toast.error(t.error.message),this.loading=!1}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(e=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.subscriptions.route=this.route.queryParams.subscribe(e=>{this.mode=e.mode,this.storeId=e.storeId,this.supplierId=e.supplierId,"add"!=this.mode&&this.get()})}ngOnDestroy(){this.subscriptions.form.unsubscribe(),this.subscriptions.route.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(B.Pb(N.a),B.Pb(D.a),B.Pb(M.a),B.Pb(F.a),B.Pb(G.a))},e.\u0275cmp=B.Jb({type:e,selectors:[["app-supplier-editor-page"]],decls:60,vars:12,consts:[["color","primary"],["mat-icon-button","",1,"menu-toggle",3,"click"],[1,"page-title","spacer"],["mode","indeterminate",4,"ngIf"],[1,"page-body"],[3,"formGroup","ngSubmit"],["appearance","outline"],["text-uppercase",""],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],[4,"ngIf"],["name","organizationOnly","placeholder","Sharing Rules","formControlName","organizationOnly","required",""],[3,"value"],["formGroupName","address"],["matInput","","type","text","name","street","placeholder","street","formControlName","street","required",""],["matInput","","type","text","name","suburb","placeholder","suburb","formControlName","suburb","required",""],["matInput","","type","text","name","cityTown","placeholder","City/Town","formControlName","cityTown","required",""],["matInput","","type","text","name","postalCode","placeholder","Postal Code","formControlName","postalCode","required",""],["matInput","","type","email","name","email","placeholder","email","formControlName","email","required",""],["matInput","","type","tel","name","phone","placeholder","phone","formControlName","phone","required",""],["type","submit","mat-flat-button","","color","primary"],["mode","indeterminate"]],template:function(e,t){1&e&&(B.Vb(0,"mat-toolbar",0),B.Vb(1,"button",1),B.dc("click",(function(){return t.history.back()})),B.Vb(2,"mat-icon"),B.Bc(3," arrow_back "),B.Ub(),B.Ub(),B.Vb(4,"label",2),B.Bc(5," supplier editor "),B.Ub(),B.Ub(),B.Ac(6,K,1,0,"mat-progress-bar",3),B.Vb(7,"div",4),B.Vb(8,"form",5),B.dc("ngSubmit",(function(){return!t.form.invalid&&!t.loading&&t.submit()})),B.Vb(9,"mat-form-field",6),B.Vb(10,"mat-label",7),B.Bc(11," description "),B.Ub(),B.Qb(12,"input",8),B.Ac(13,R,2,1,"mat-error",9),B.Ub(),B.Vb(14,"mat-form-field",6),B.Vb(15,"mat-label",7),B.Bc(16," Sharing Rules "),B.Ub(),B.Vb(17,"mat-select",10),B.Vb(18,"mat-option",11),B.Bc(19," Share To Anyone "),B.Ub(),B.Vb(20,"mat-option",11),B.Bc(21," Share In Organization "),B.Ub(),B.Ub(),B.Ac(22,E,2,1,"mat-error",9),B.Ub(),B.Vb(23,"h2"),B.Bc(24," address "),B.Ub(),B.Vb(25,"div",12),B.Vb(26,"mat-form-field",6),B.Vb(27,"mat-label",7),B.Bc(28," street "),B.Ub(),B.Qb(29,"input",13),B.Ac(30,J,2,1,"mat-error",9),B.Ub(),B.Vb(31,"mat-form-field",6),B.Vb(32,"mat-label",7),B.Bc(33," suburb "),B.Ub(),B.Qb(34,"input",14),B.Ac(35,X,2,1,"mat-error",9),B.Ub(),B.Vb(36,"mat-form-field",6),B.Vb(37,"mat-label",7),B.Bc(38," City/Town "),B.Ub(),B.Qb(39,"input",15),B.Ac(40,Z,2,1,"mat-error",9),B.Ub(),B.Vb(41,"mat-form-field",6),B.Vb(42,"mat-label",7),B.Bc(43," Postal Code "),B.Ub(),B.Qb(44,"input",16),B.Ac(45,L,2,1,"mat-error",9),B.Ub(),B.Ub(),B.Vb(46,"h2"),B.Bc(47," contact "),B.Ub(),B.Vb(48,"mat-form-field",6),B.Vb(49,"mat-label",7),B.Bc(50," email "),B.Ub(),B.Qb(51,"input",17),B.Ac(52,W,2,1,"mat-error",9),B.Ub(),B.Vb(53,"mat-form-field",6),B.Vb(54,"mat-label",7),B.Bc(55," phone "),B.Ub(),B.Qb(56,"input",18),B.Ac(57,$,2,1,"mat-error",9),B.Ub(),B.Vb(58,"button",19),B.Bc(59," submit "),B.Ub(),B.Ub(),B.Ub()),2&e&&(B.Cb(6),B.oc("ngIf",t.loading),B.Cb(2),B.oc("formGroup",t.form),B.Cb(5),B.oc("ngIf",t.errors.description),B.Cb(5),B.oc("value",0),B.Cb(2),B.oc("value",1),B.Cb(2),B.oc("ngIf",t.errors.organizationOnly),B.Cb(8),B.oc("ngIf",t.errors.address.street),B.Cb(5),B.oc("ngIf",t.errors.address.suburb),B.Cb(5),B.oc("ngIf",t.errors.address.cityTown),B.Cb(5),B.oc("ngIf",t.errors.address.postalCode),B.Cb(7),B.oc("ngIf",t.errors.email),B.Cb(5),B.oc("ngIf",t.errors.phone))},directives:[f.a,h.a,d.a,c.l,S.r,S.k,S.e,y.c,y.g,b.a,S.a,S.j,S.c,S.p,m.a,p.k,S.f,C.a,y.b],styles:["form[_ngcontent-%COMP%]{width:400px;margin:10px auto}form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:14px;line-height:14px;margin:0 0 5px;text-transform:uppercase}form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}@media screen and (max-width:420px){form[_ngcontent-%COMP%]{width:calc(100% - 20px);margin:10px}}"]}),e})()}];let Y=(()=>{class e{}return e.\u0275mod=B.Nb({type:e}),e.\u0275inj=B.Mb({factory:function(t){return new(t||e)},imports:[[N.f.forChild(H)],N.f]}),e})(),ee=(()=>{class e{}return e.\u0275mod=B.Nb({type:e}),e.\u0275inj=B.Mb({factory:function(t){return new(t||e)},imports:[[o.a,s.a,S.g,i.a,n.a,a.a,c.c,d.b,l.c,b.b,m.b,u.c,h.b,p.p,f.b,g.a,y.e,I.a,S.o,V.c,C.b,Y]]}),e})()}}]);