(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{NwyA:function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var i=r("ofXK"),o=r("NFeN"),s=r("MutI"),n=r("fXoL");let a=(()=>{class t{}return t.\u0275mod=n.Nb({type:t}),t.\u0275inj=n.Mb({factory:function(e){return new(e||t)},imports:[[i.c,o.b,s.c]]}),t})()},ZGGN:function(t,e,r){"use strict";r.r(e),r.d(e,"DepartmentsModule",(function(){return T}));var i=r("2xuv"),o=r("ojfV"),s=r("ofXK"),n=r("+PXZ"),a=r("3lET"),c=r("CSBE"),d=r("NFeN"),l=r("MutI"),b=r("qFsG"),m=r("0IaG"),p=r("FKr1"),u=r("d3UM"),h=r("bTqV"),f=r("/t3+"),g=r("kmnG"),y=r("NwyA"),I=r("bv9b"),v=r("2ChS"),C=r("mrSG"),O=r("+bmA"),P=r("KK9o"),w=r("IQQo"),V=r("HqD8"),U=r("nFDT"),k=r("jDep"),x=r("fXoL"),M=r("d3yR"),B=r("9ZKQ"),q=r("G0b6"),z=r("tyNb"),j=r("wPrS"),N=r("sC6t");function _(t,e){1&t&&x.Qb(0,"mat-progress-bar",8)}function D(t,e){if(1&t){const t=x.Wb();x.Vb(0,"mat-list-item",9),x.dc("click",(function(){x.uc(t);const r=e.$implicit;return x.hc().options(r)})),x.Vb(1,"h3"),x.Bc(2),x.Ub(),x.Ub()}if(2&t){const t=e.$implicit;x.Cb(2),x.Dc(" ",t.description," ")}}const S=function(t){return{mode:"add",storeId:t}};let A=(()=>{class t{constructor(t,e,r,i,o,s,n){this.menu=t,this.toast=e,this.sheet=r,this.dialog=i,this.departments=o,this.route=s,this.router=n,this.filter="",this.subscriptions={}}list(){return Object(C.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.departments.list({filter:["role","storeId","description","departmentId"],storeId:this.storeId});this.departments.data=t.ok?t.result:[],this.loading=!1}))}options(t){return Object(C.a)(this,void 0,void 0,(function*(){const e=yield this.sheet.open(k.a,{data:{items:[{role:t.role,icon:"edit",scope:3,title:"Edit",option:1},{role:t.role,icon:"file_copy",scope:3,title:"Copy",option:2},{role:t.role,icon:"share",scope:4,title:"Share",option:3},{role:t.role,icon:"people",scope:4,title:"Subscribers",option:4},{role:t.role,icon:"remove",scope:1,color:"warn",title:"Unsubscribe",option:5},{role:t.role,icon:"delete",scope:5,color:"warn",title:"Delete",option:6}],title:t.description}});yield e.afterDismissed().subscribe(e=>Object(C.a)(this,void 0,void 0,(function*(){if(e)switch(e){case 1:this.router.navigate(["/departments","editor"],{queryParams:{mode:"update",storeId:this.storeId,departmentId:t.departmentId}});break;case 2:this.router.navigate(["/departments","editor"],{queryParams:{mode:"copy",storeId:this.storeId,departmentId:t.departmentId}});break;case 3:const e=yield this.dialog.open(O.a,{panelClass:"share-dialog"});yield e.afterClosed().subscribe(e=>Object(C.a)(this,void 0,void 0,(function*(){if(e){this.loading=!0;const r=yield this.departments.share({role:e.role,email:e.email,storeId:this.storeId,departmentId:t.departmentId});r.ok?this.toast.success("user was shared!"):this.toast.error(r.error.message),this.loading=!1}})));break;case 4:this.dialog.open(U.a,{data:{id:t.departmentId,type:"department",storeId:this.storeId,service:this.departments},panelClass:"subscribers-dialog"});break;case 5:const r=yield this.dialog.open(V.a,{panelClass:"unsubscribe-dialog"});yield r.afterClosed().subscribe(e=>Object(C.a)(this,void 0,void 0,(function*(){if(e){this.loading=!0;const e=yield this.departments.unsubscribe({storeId:this.storeId,departmentId:t.departmentId});e.ok?this.toast.success("you were unsubscribed from department!"):this.toast.error(e.error.message),this.loading=!1}})));break;case 6:const i=yield this.dialog.open(P.a,{panelClass:"delete-dialog"});yield i.afterClosed().subscribe(e=>Object(C.a)(this,void 0,void 0,(function*(){if(e){this.loading=!0;const e=yield this.departments.delete({storeId:this.storeId,departmentId:t.departmentId});e.ok?this.toast.success("department was deleted!"):this.toast.error(e.error.message),this.loading=!1}})))}})))}))}ngOnInit(){this.subscriptions.route=this.route.queryParams.subscribe(t=>{void 0!==t.storeId&&null!=t.storeId&&""!=t.storeId?(this.storeId=t.storeId,this.list()):this.router.navigate(["/stores"])}),this.subscriptions.search=this.search.change.subscribe(t=>{this.filter=t})}ngOnDestroy(){this.subscriptions.route.unsubscribe(),this.subscriptions.search.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(x.Pb(M.a),x.Pb(B.a),x.Pb(v.b),x.Pb(m.b),x.Pb(q.a),x.Pb(z.a),x.Pb(z.c))},t.\u0275cmp=x.Jb({type:t,selectors:[["app-departments-page"]],viewQuery:function(t,e){var r;1&t&&x.yc(w.a,!0),2&t&&x.rc(r=x.ec())&&(e.search=r.first)},decls:16,vars:12,consts:[["color","primary"],["mat-icon-button","",1,"menu-toggle",3,"click"],[1,"page-title","spacer"],["placeholder","search departments"],["mat-icon-button","","routerLink","editor",3,"queryParams"],["mode","indeterminate",4,"ngIf"],[1,"page-body"],["matRipple","",3,"click",4,"ngFor","ngForOf"],["mode","indeterminate"],["matRipple","",3,"click"]],template:function(t,e){1&t&&(x.Vb(0,"mat-toolbar",0),x.Vb(1,"button",1),x.dc("click",(function(){return e.menu.toggle()})),x.Vb(2,"mat-icon"),x.Bc(3," menu "),x.Ub(),x.Ub(),x.Vb(4,"label",2),x.Bc(5," departments "),x.Ub(),x.Qb(6,"search",3),x.Vb(7,"button",4),x.Vb(8,"mat-icon"),x.Bc(9," add "),x.Ub(),x.Ub(),x.Ub(),x.Ac(10,_,1,0,"mat-progress-bar",5),x.Vb(11,"div",6),x.Vb(12,"mat-list"),x.Ac(13,D,3,1,"mat-list-item",7),x.ic(14,"filterBy"),x.ic(15,"orderBy"),x.Ub(),x.Ub()),2&t&&(x.Cb(7),x.oc("queryParams",x.qc(10,S,e.storeId)),x.Cb(3),x.oc("ngIf",e.loading),x.Cb(3),x.oc("ngForOf",x.lc(14,3,x.kc(15,7,e.departments.data,"description"),"description",e.filter)))},directives:[f.a,h.a,d.a,w.a,z.d,s.m,l.a,s.l,I.a,l.b,p.r],pipes:[j.a,N.a],styles:["mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{flex:1 auto;cursor:pointer;display:flex;align-items:center;border-bottom:1px solid #e0e0e0;flex-direction:row}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:14px;text-transform:uppercase}"]}),t})();var F=r("3Pt+"),G=r("5mtf"),Q=r("dWDE");function K(t,e){1&t&&x.Qb(0,"mat-progress-bar",13)}function R(t,e){if(1&t&&(x.Vb(0,"mat-error"),x.Bc(1),x.Ub()),2&t){const t=x.hc();x.Cb(1),x.Dc(" ",t.errors.description," ")}}function X(t,e){if(1&t&&(x.Vb(0,"mat-error"),x.Bc(1),x.Ub()),2&t){const t=x.hc();x.Cb(1),x.Dc(" ",t.errors.organizationOnly," ")}}const E=[{path:"",component:A},{path:"editor",component:(()=>{class t{constructor(t,e,r,i,o){this.route=t,this.toast=e,this.service=r,this.history=i,this.formerror=o,this.form=new F.e({description:new F.b("",[F.s.required]),organizationOnly:new F.b(1,[F.s.required])}),this.errors={description:"",organizationOnly:""},this.subscriptions={}}get(){return Object(C.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["role","description","organizationOnly"],storeId:this.storeId,departmentId:this.departmentId});t.ok?(t.result.role<3&&this.history.back(),this.form.controls.description.setValue(t.result.description),this.form.controls.organizationOnly.setValue(t.result.organizationOnly)):this.toast.error(t.error.message),this.loading=!1}))}submit(){return Object(C.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add",delete this.departmentId);const e=yield this.service[t]({storeId:this.storeId,description:this.form.value.description,departmentId:this.departmentId,organizationOnly:this.form.value.organizationOnly});e.ok?(this.toast.success("department was updated!"),this.history.back()):this.toast.error(e.error.message),this.loading=!1}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.subscriptions.route=this.route.queryParams.subscribe(t=>{this.mode=t.mode,this.storeId=t.storeId,this.departmentId=t.departmentId,"add"!=this.mode&&this.get()})}ngOnDestroy(){this.subscriptions.form.unsubscribe(),this.subscriptions.route.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(x.Pb(z.a),x.Pb(B.a),x.Pb(q.a),x.Pb(G.a),x.Pb(Q.a))},t.\u0275cmp=x.Jb({type:t,selectors:[["app-department-editor-page"]],decls:25,vars:6,consts:[["color","primary"],["mat-icon-button","",1,"menu-toggle",3,"click"],[1,"page-title","spacer"],["mode","indeterminate",4,"ngIf"],[1,"page-body"],[3,"formGroup","ngSubmit"],["appearance","outline"],["text-uppercase",""],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],[4,"ngIf"],["name","organizationOnly","placeholder","Sharing Rules","formControlName","organizationOnly","required",""],[3,"value"],["type","submit","mat-flat-button","","color","primary"],["mode","indeterminate"]],template:function(t,e){1&t&&(x.Vb(0,"mat-toolbar",0),x.Vb(1,"button",1),x.dc("click",(function(){return e.history.back()})),x.Vb(2,"mat-icon"),x.Bc(3," arrow_back "),x.Ub(),x.Ub(),x.Vb(4,"label",2),x.Bc(5," department editor "),x.Ub(),x.Ub(),x.Ac(6,K,1,0,"mat-progress-bar",3),x.Vb(7,"div",4),x.Vb(8,"form",5),x.dc("ngSubmit",(function(){return!e.form.invalid&&!e.loading&&e.submit()})),x.Vb(9,"mat-form-field",6),x.Vb(10,"mat-label",7),x.Bc(11," description "),x.Ub(),x.Qb(12,"input",8),x.Ac(13,R,2,1,"mat-error",9),x.Ub(),x.Vb(14,"mat-form-field",6),x.Vb(15,"mat-label",7),x.Bc(16," Sharing Rules "),x.Ub(),x.Vb(17,"mat-select",10),x.Vb(18,"mat-option",11),x.Bc(19," Share To Anyone "),x.Ub(),x.Vb(20,"mat-option",11),x.Bc(21," Share In Organization "),x.Ub(),x.Ub(),x.Ac(22,X,2,1,"mat-error",9),x.Ub(),x.Vb(23,"button",12),x.Bc(24," submit "),x.Ub(),x.Ub(),x.Ub()),2&t&&(x.Cb(6),x.oc("ngIf",e.loading),x.Cb(2),x.oc("formGroup",e.form),x.Cb(5),x.oc("ngIf",e.errors.description),x.Cb(5),x.oc("value",0),x.Cb(2),x.oc("value",1),x.Cb(2),x.oc("ngIf",e.errors.organizationOnly))},directives:[f.a,h.a,d.a,s.m,F.t,F.m,F.f,g.c,g.g,b.b,F.a,F.l,F.d,F.r,u.a,p.n,I.a,g.b],styles:["form[_ngcontent-%COMP%]{width:400px;margin:10px auto}form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:14px;line-height:14px;margin:0 0 5px;text-transform:uppercase}form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}@media screen and (max-width:420px){form[_ngcontent-%COMP%]{width:calc(100% - 20px);margin:10px}}"]}),t})()}];let J=(()=>{class t{}return t.\u0275mod=x.Nb({type:t}),t.\u0275inj=x.Mb({factory:function(e){return new(e||t)},imports:[[z.g.forChild(E)],z.g]}),t})(),T=(()=>{class t{}return t.\u0275mod=x.Nb({type:t}),t.\u0275inj=x.Mb({factory:function(e){return new(e||t)},imports:[[o.a,i.a,F.h,n.a,a.a,c.a,s.c,d.b,l.c,b.c,u.b,m.c,h.b,p.s,f.b,g.e,y.a,F.q,v.c,I.b,J]]}),t})()}}]);