(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{m8FW:function(t,e,o){"use strict";o.r(e),o.d(e,"VouchersPageModule",(function(){return mt}));var r=o("mrSG"),i=o("Dh3D");class s extends class{constructor(t){void 0!==t&&null!=t&&(void 0!==t.loading&&null!=t.loading&&(this.loading=t.loading),void 0!==t.selected&&null!=t.selected&&(this.selected=t.selected))}}{constructor(t){super(t),void 0!==t&&null!=t&&(void 0!==t.role&&null!=t.role&&(this.role=t.role),void 0!==t.code&&null!=t.code&&(this.code=t.code),void 0!==t.file&&null!=t.file&&(this.file=t.file),void 0!==t.status&&null!=t.status&&(this.status=t.status),void 0!==t.storeId&&null!=t.storeId&&(this.storeId=t.storeId),void 0!==t.productId&&null!=t.productId&&(this.productId=t.productId),void 0!==t.voucherId&&null!=t.voucherId&&(this.voucherId=t.voucherId),void 0!==t.description&&null!=t.description&&(this.description=t.description))}}var c=o("+0xr"),n=o("fXoL"),a=o("9ZKQ"),d=o("u0tM"),l=o("swrf"),u=o("tyNb"),h=o("QwKq"),b=o("BhS5"),m=o("WF9o"),f=o("4jEk"),p=o("ofXK"),v=o("bv9b"),g=o("bTqV"),I=o("NFeN"),k=o("Xa2L");function A(t,e){1&t&&n.Nb(0,"mat-progress-bar",11)}function C(t,e){1&t&&(n.Sb(0,"th",12),n.Cc(1," Description "),n.Rb())}function w(t,e){if(1&t&&(n.Sb(0,"td",13),n.Cc(1),n.Rb()),2&t){const t=e.$implicit;n.Ab(1),n.Ec(" ",t.description," ")}}function R(t,e){1&t&&(n.Sb(0,"th",12),n.Cc(1," Code "),n.Rb())}function S(t,e){if(1&t&&(n.Sb(0,"td",13),n.Cc(1),n.Rb()),2&t){const t=e.$implicit;n.Ab(1),n.Ec(" ",t.code," ")}}function y(t,e){1&t&&(n.Sb(0,"th",12),n.Cc(1," Status "),n.Rb())}function M(t,e){if(1&t&&(n.Sb(0,"td",13),n.Sb(1,"span"),n.Cc(2),n.Rb(),n.Rb()),2&t){const t=e.$implicit;n.Ab(1),n.Cb(t.status),n.Ab(1),n.Ec(" ",t.status," ")}}function O(t,e){1&t&&n.Nb(0,"th",14)}function D(t,e){if(1&t){const t=n.Tb();n.Sb(0,"button",17),n.ac("click",(function(){n.rc(t);const e=n.ec().$implicit;return n.ec().options(e)})),n.Sb(1,"mat-icon"),n.Cc(2," more_vert "),n.Rb(),n.Rb()}}function P(t,e){1&t&&n.Nb(0,"mat-spinner",18)}function N(t,e){if(1&t&&(n.Sb(0,"td",13),n.Ac(1,D,3,0,"button",15),n.Ac(2,P,1,0,"mat-spinner",16),n.Rb()),2&t){const t=e.$implicit;n.Ab(1),n.kc("ngIf",!t.loading),n.Ab(1),n.kc("ngIf",t.loading)}}function q(t,e){1&t&&n.Nb(0,"tr",19)}function x(t,e){1&t&&n.Nb(0,"tr",20)}let E=(()=>{class t{constructor(t,e,o,r,i,s,n){this.toast=t,this.sheet=e,this.confirm=o,this.router=r,this.service=i,this.buttons=s,this.localstorage=n,this.columns=["description","code","status","options"],this.vouchers=new c.o,this.subscriptions={}}list(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({sort:{description:1},filter:["role","code","status","voucherId","description"]});this.vouchers.data=t.ok?t.result.map(t=>new s(t)):[],this.loading=!1}))}options(t){return Object(r.a)(this,void 0,void 0,(function*(){let e=[{icon:"edit",title:"Edit Voucher",handler:()=>{this.router.navigate(["/vouchers","editor"],{queryParams:{mode:"update",voucherId:t.voucherId}})},disabled:[0,1]},{icon:"content_copy",title:"Copy Voucher",handler:()=>{this.router.navigate(["/vouchers","editor"],{queryParams:{mode:"copy",voucherId:t.voucherId}})},disabled:[0,1]},{icon:"sell",title:"Mark as sold",handler:()=>Object(r.a)(this,void 0,void 0,(function*(){t.loading=!0;const e=yield this.service.markassold({voucherId:t.voucherId});e.ok?t.status="sold":this.toast.error(e.error.message),t.loading=!1})),disabled:[0,1]},{icon:"delete",title:"Delete",danger:!0,handler:()=>{this.confirm.show({message:"Delete "+t.code,handler:()=>Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.service.delete({voucherId:t.voucherId});if(e.ok){for(let e=0;e<this.vouchers.data.length;e++)if(this.vouchers.data[e].voucherId==t.voucherId){this.vouchers.data.splice(e,1);break}this.vouchers.data=this.vouchers.data.map(t=>new s(t)),this.toast.success("Voucher was removed!")}else this.toast.error(e.error.message);this.loading=!1}))})},disabled:[0,1,2,3,4]}];if("sold"==t.status){for(let t=0;t<e.length;t++)if("sell"==e[t].icon){e.splice(t,1);break}for(let t=0;t<e.length;t++)if("edit"==e[t].icon){e.splice(t,1);break}for(let t=0;t<e.length;t++)if("delete"==e[t].icon){e.splice(t,1);break}}this.sheet.show({role:t.role,title:t.code,options:e})}))}ngOnInit(){this.buttons.show("add"),this.buttons.hide("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.sort.active="description",this.sort.direction="desc",this.vouchers.sort=this.sort,this.subscriptions.add=this.buttons.add.click.subscribe(t=>{this.router.navigate(["/vouchers","editor"],{queryParams:{mode:"add"}})}),this.subscriptions.filter=this.buttons.filter.click.subscribe(t=>{}),this.list()}ngOnDestroy(){this.subscriptions.add.unsubscribe(),this.subscriptions.filter.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(n.Mb(a.a),n.Mb(d.a),n.Mb(l.a),n.Mb(u.b),n.Mb(h.a),n.Mb(b.a),n.Mb(m.a))},t.\u0275cmp=n.Gb({type:t,selectors:[["vouchers-page"]],viewQuery:function(t,e){var o;1&t&&n.wc(i.a,!0),2&t&&n.oc(o=n.bc())&&(e.sort=o.first)},decls:17,vars:5,consts:[["mode","indeterminate",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","description"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","status"],["matColumnDef","options"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","",3,"click",4,"ngIf"],["diameter","30","strokeWidth","4",4,"ngIf"],["mat-icon-button","",3,"click"],["diameter","30","strokeWidth","4"],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(n.Sb(0,"mat-content"),n.Ac(1,A,1,0,"mat-progress-bar",0),n.Sb(2,"table",1),n.Qb(3,2),n.Ac(4,C,2,0,"th",3),n.Ac(5,w,2,1,"td",4),n.Pb(),n.Qb(6,5),n.Ac(7,R,2,0,"th",3),n.Ac(8,S,2,1,"td",4),n.Pb(),n.Qb(9,6),n.Ac(10,y,2,0,"th",3),n.Ac(11,M,3,3,"td",4),n.Pb(),n.Qb(12,7),n.Ac(13,O,1,0,"th",8),n.Ac(14,N,3,2,"td",4),n.Pb(),n.Ac(15,q,1,0,"tr",9),n.Ac(16,x,1,0,"tr",10),n.Rb(),n.Rb()),2&t&&(n.Ab(1),n.kc("ngIf",e.loading),n.Ab(1),n.kc("dataSource",e.vouchers),n.Ab(13),n.kc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),n.Ab(1),n.kc("matRowDefColumns",e.columns))},directives:[f.a,p.m,c.n,i.a,c.c,c.i,c.b,c.k,c.m,v.a,c.h,i.b,c.a,g.a,I.a,k.b,c.j,c.l],styles:[".mat-column-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff;padding:5px 10px;font-size:12px;line-height:12px;border-radius:12px;background-color:#e0e0e0}.mat-column-status[_ngcontent-%COMP%]   .sold[_ngcontent-%COMP%]{background-color:#4caf50}.mat-column-status[_ngcontent-%COMP%]   .available[_ngcontent-%COMP%]{background-color:#2196f3}.mat-column-options[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-left:5px!important}"]}),t})();var j=o("o3Q1"),F=o("HYeg"),V=o("3Pt+"),_=o("btHx"),G=o("X849"),H=o("dWDE"),Q=o("in+p"),W=o("FKr1"),$=o("kmnG"),L=o("d3UM"),B=o("WJ5W"),J=o("qFsG"),K=o("ZRfb"),T=o("AbOq"),X=o("roMP");function Z(t,e){1&t&&n.Nb(0,"mat-progress-bar",16)}function z(t,e){if(1&t&&(n.Sb(0,"mat-option",17),n.Cc(1),n.Rb()),2&t){const t=e.$implicit;n.kc("value",t.storeId)("disabled",t.role<2),n.Ab(1),n.Ec(" ",t.description," ")}}function Y(t,e){if(1&t&&(n.Sb(0,"mat-error"),n.Cc(1),n.Rb()),2&t){const t=n.ec();n.Ab(1),n.Ec(" ",t.errors.storeId," ")}}function U(t,e){if(1&t&&(n.Sb(0,"mat-option",17),n.Cc(1),n.Rb()),2&t){const t=e.$implicit;n.kc("value",t.productId)("disabled",t.role<2),n.Ab(1),n.Ec(" ",t.title," ")}}function tt(t,e){if(1&t&&(n.Sb(0,"mat-error"),n.Cc(1),n.Rb()),2&t){const t=n.ec();n.Ab(1),n.Ec(" ",t.errors.productId," ")}}function et(t,e){if(1&t&&(n.Sb(0,"mat-error"),n.Cc(1),n.Rb()),2&t){const t=n.ec();n.Ab(1),n.Ec(" ",t.errors.code," ")}}const ot=function(t){return{description:t}},rt=function(t){return{title:t}};let it=(()=>{class t{constructor(t,e,o,r,i,c,n,a){this.toast=t,this.route=e,this.stores=o,this.router=r,this.service=i,this.products=c,this.buttons=n,this.formerror=a,this.form=new V.f({code:new V.c(null,[V.t.required]),file:new V.c(null,[V.t.required]),storeId:new V.c(null,[V.t.required]),productId:new V.c(null,[V.t.required])}),this.errors={code:"",file:"",storeId:"",productId:""},this.filter=new V.f({store:new V.c(null,[V.t.required]),product:new V.c(null,[V.t.required])}),this.voucher=new s,this.subscriptions={}}get(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["role","code","file","storeId","productId"],voucherId:this.voucherId});t.ok?(this.voucher=new s(t.result),this.voucher.role>2?(this.form.controls.code.setValue(this.voucher.code),this.form.controls.file.setValue(this.voucher.file),this.form.controls.storeId.setValue(this.voucher.storeId),this.form.controls.productId.setValue(this.voucher.productId)):(this.toast.error("Your role is not high enough to copy/edit this voucher!"),this.router.navigate(["/vouchers"]))):(this.toast.error(t.error.message),this.router.navigate(["/vouchers"])),this.loading=!1}))}load(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({sort:{file:1},filter:["storeId","description"]});t.ok?this.stores.data=t.result.map(t=>new j.a(t)):(this.stores.data=[],this.toast.error(t.error.message));const e=yield this.products.list({sort:{title:1},filter:["title","productId"],type:"voucher"});e.ok?this.products.data=e.result.map(t=>new F.a(t)):(this.products.data=[],this.toast.error(e.error.message)),this.loading=!1}))}submit(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add",delete this.voucherId);const e=yield this.service[t]({code:this.form.value.code,file:this.form.value.file,storeId:this.form.value.storeId,voucherId:this.voucherId,productId:this.form.value.productId});e.ok?this.router.navigate(["/vouchers"]):this.toast.error(e.error.message),this.loading=!1}))}upload(t,e){this.form.controls[t].setValue(e)}ngOnInit(){this.buttons.hide("add"),this.buttons.show("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.subscriptions.close=this.buttons.close.click.subscribe(t=>{this.router.navigate(["/vouchers"])});const t=this.route.snapshot.queryParams;this.mode=t.mode,this.voucherId=t.voucherId,(()=>{Object(r.a)(this,void 0,void 0,(function*(){"add"!=this.mode&&(yield this.get()),yield this.load()}))})()}ngOnDestroy(){this.subscriptions.form.unsubscribe(),this.subscriptions.close.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(n.Mb(a.a),n.Mb(u.a),n.Mb(_.a),n.Mb(u.b),n.Mb(h.a),n.Mb(G.a),n.Mb(b.a),n.Mb(H.a))},t.\u0275cmp=n.Gb({type:t,selectors:[["vouchers-editor-page"]],decls:37,vars:26,consts:[["mode","indeterminate",4,"ngIf"],[1,"container"],[3,"formGroup","ngSubmit"],["upload","","upload-accept","application/pdf","matRipple","",1,"file",3,"upload-src","upload-change"],["appearance","outline"],["name","storeId","formControlName","storeId","required",""],[3,"formGroup"],["placeholderLabel","filter stores","noEntriesFoundLabel","no stores found","formControlName","store"],[3,"value","disabled",4,"ngFor","ngForOf"],[4,"ngIf"],["name","productId","formControlName","productId","required",""],["placeholderLabel","filter products","noEntriesFoundLabel","no products found","formControlName","product"],["matInput","","type","text","name","code","placeholder","code","formControlName","code","required",""],["type","submit",2,"display","none"],["button",""],["type","button","color","primary","mat-flat-button","",3,"click"],["mode","indeterminate"],[3,"value","disabled"]],template:function(t,e){if(1&t){const t=n.Tb();n.Sb(0,"mat-content"),n.Ac(1,Z,1,0,"mat-progress-bar",0),n.Sb(2,"div",1),n.Sb(3,"form",2),n.ac("ngSubmit",(function(){return!e.form.invalid&&!e.loading&&e.submit()})),n.Sb(4,"div",3),n.ac("upload-change",(function(t){return e.upload("file",t)})),n.Sb(5,"mat-icon"),n.Cc(6," upload "),n.Rb(),n.Rb(),n.Sb(7,"mat-form-field",4),n.Sb(8,"mat-label"),n.Cc(9," Store "),n.Rb(),n.Sb(10,"mat-select",5),n.Sb(11,"mat-option",6),n.Nb(12,"ngx-mat-select-search",7),n.Rb(),n.Ac(13,z,2,3,"mat-option",8),n.fc(14,"filterBy"),n.fc(15,"orderBy"),n.Rb(),n.Ac(16,Y,2,1,"mat-error",9),n.Rb(),n.Sb(17,"mat-form-field",4),n.Sb(18,"mat-label"),n.Cc(19," Product "),n.Rb(),n.Sb(20,"mat-select",10),n.Sb(21,"mat-option",6),n.Nb(22,"ngx-mat-select-search",11),n.Rb(),n.Ac(23,U,2,3,"mat-option",8),n.fc(24,"filterBy"),n.fc(25,"orderBy"),n.Rb(),n.Ac(26,tt,2,1,"mat-error",9),n.Rb(),n.Sb(27,"mat-form-field",4),n.Sb(28,"mat-label"),n.Cc(29," Redeem Code "),n.Rb(),n.Nb(30,"input",12),n.Ac(31,et,2,1,"mat-error",9),n.Rb(),n.Nb(32,"button",13,14),n.Rb(),n.Rb(),n.Rb(),n.Sb(34,"mat-footer"),n.Sb(35,"button",15),n.ac("click",(function(){return n.rc(t),n.pc(33).click()})),n.Cc(36," submit "),n.Rb(),n.Rb()}2&t&&(n.Ab(1),n.kc("ngIf",e.loading),n.Ab(2),n.kc("formGroup",e.form),n.Ab(1),n.kc("upload-src",e.form.value.file),n.Ab(7),n.kc("formGroup",e.filter),n.Ab(2),n.kc("ngForOf",n.hc(14,10,n.hc(15,13,e.stores.data,"description"),n.mc(22,ot,e.filter.value.store))),n.Ab(3),n.kc("ngIf",e.errors.storeId),n.Ab(5),n.kc("formGroup",e.filter),n.Ab(2),n.kc("ngForOf",n.hc(24,16,n.hc(25,19,e.products.data,"title"),n.mc(24,rt,e.filter.value.product))),n.Ab(3),n.kc("ngIf",e.errors.productId),n.Ab(5),n.kc("ngIf",e.errors.code))},directives:[f.a,p.m,V.u,V.n,V.g,Q.a,W.o,I.a,$.c,$.f,L.a,V.m,V.e,V.s,W.k,B.a,p.l,J.a,V.b,K.a,g.a,v.a,$.b],pipes:[T.a,X.a],styles:[".file[_ngcontent-%COMP%]{width:150px;margin:auto;height:150px;border:1px solid #e0e0e0;display:flex;align-items:center;border-radius:5px;justify-content:center;background-color:#fafafa}"]}),t})();var st=o("5Yg0"),ct=o("gyTc"),nt=o("R32p"),at=o("A5z7"),dt=o("tVzd"),lt=o("J89Z"),ut=o("p/0r"),ht=o("H0Zp");const bt=[{path:"",component:E},{path:"editor",component:it}];let mt=(()=>{class t{}return t.\u0275mod=n.Kb({type:t}),t.\u0275inj=n.Jb({factory:function(e){return new(e||t)},imports:[[V.i,p.c,st.a,nt.a,i.c,i.c,ct.a,I.b,c.p,at.e,J.b,W.p,g.b,L.b,dt.a,lt.a,ut.a,ht.a,$.e,V.r,v.b,k.a,B.b,u.e.forChild(bt)]]}),t})()}}]);