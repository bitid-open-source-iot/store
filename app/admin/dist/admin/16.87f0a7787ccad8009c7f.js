(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{a1ig:function(t,e,i){"use strict";i.r(e),i.d(e,"ProductsPageModule",(function(){return ge}));var o=i("mrSG"),r=i("o3Q1"),s=i("HYeg"),n=i("Dh3D"),l=i("+0xr"),a=i("3Pt+"),c=i("0IaG"),d=i("fXoL"),u=i("btHx"),h=i("dWDE"),m=i("/t3+"),b=i("kmnG"),p=i("bTqV"),f=i("NFeN"),g=i("4jEk"),v=i("d3UM"),y=i("FKr1"),S=i("WJ5W"),C=i("ofXK"),R=i("AbOq"),w=i("roMP");function k(t,e){if(1&t&&(d.Sb(0,"mat-option",10),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.storeId),d.Ab(1),d.Ec(" ",t.description," ")}}function A(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.storeId," ")}}const I=function(t){return{description:t}};let x=(()=>{class t{constructor(t,e,i,o){this.dialog=t,this.config=e,this.stores=i,this.formerror=o,this.form=new a.f({storeId:new a.c([])}),this.filter=new a.f({store:new a.c("")}),this.errors={storeId:""},this.subscriptions={}}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({filter:["storeId","description"]});this.stores.data=t.ok?t.result.map(t=>new r.a(t)):[],void 0!==this.config.storeId&&null!=this.config.storeId&&this.form.controls.storeId.setValue(this.config.storeId),this.loading=!1}))}close(){return Object(o.a)(this,void 0,void 0,(function*(){this.dialog.close(!1)}))}submit(){return Object(o.a)(this,void 0,void 0,(function*(){this.dialog.close(this.form.value)}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.load()}ngOnDestroy(){this.subscriptions.form.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(c.d),d.Mb(c.a),d.Mb(u.a),d.Mb(h.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["products-filter-dialog"]],decls:20,vars:12,consts:[[1,"spacer"],["mat-icon-button","",3,"click"],[3,"formGroup","ngSubmit"],["appearance","outline"],["name","storeId","formControlName","storeId","multiple",""],[3,"formGroup"],["placeholderLabel","filter stores","noEntriesFoundLabel","no stores found","formControlName","store"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","submit","color","primary","mat-flat-button",""],[3,"value"]],template:function(t,e){1&t&&(d.Sb(0,"mat-toolbar"),d.Sb(1,"mat-label",0),d.Cc(2," Filter Products "),d.Rb(),d.Sb(3,"button",1),d.ac("click",(function(){return e.close()})),d.Sb(4,"mat-icon"),d.Cc(5," close "),d.Rb(),d.Rb(),d.Rb(),d.Sb(6,"mat-content"),d.Sb(7,"form",2),d.ac("ngSubmit",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),d.Sb(8,"mat-form-field",3),d.Sb(9,"mat-label"),d.Cc(10," Store(s) "),d.Rb(),d.Sb(11,"mat-select",4),d.Sb(12,"mat-option",5),d.Nb(13,"ngx-mat-select-search",6),d.Rb(),d.Ac(14,k,2,2,"mat-option",7),d.fc(15,"filterBy"),d.fc(16,"orderBy"),d.Rb(),d.Ac(17,A,2,1,"mat-error",8),d.Rb(),d.Sb(18,"button",9),d.Cc(19," submit "),d.Rb(),d.Rb(),d.Rb()),2&t&&(d.Ab(7),d.kc("formGroup",e.form),d.Ab(5),d.kc("formGroup",e.filter),d.Ab(2),d.kc("ngForOf",d.hc(15,4,d.hc(16,7,e.stores.data,"description"),d.mc(10,I,e.filter.value.store))),d.Ab(3),d.kc("ngIf",e.errors.storeId))},directives:[m.a,b.f,p.a,f.a,g.a,a.u,a.n,a.g,b.c,v.a,a.m,a.e,y.k,S.a,C.l,C.m,b.b],pipes:[R.a,w.a],styles:[".filter-dialog{width:500px!important}.filter-dialog .mat-dialog-container{padding:0!important}@media screen and (max-width:600px){.filter-dialog .mat-dialog-container{top:0;left:0;right:0;bottom:0;z-index:5000;position:fixed;border-radius:0}}"],encapsulation:2}),t})();var E=i("9ZKQ"),_=i("u0tM"),q=i("bS1C"),O=i("swrf"),M=i("tyNb"),V=i("X849"),T=i("BhS5"),N=i("WF9o"),P=i("bv9b"),H=i("A5z7");function z(t,e){1&t&&d.Nb(0,"mat-progress-bar",13)}function j(t,e){if(1&t){const t=d.Tb();d.Sb(0,"mat-chip",16),d.ac("removed",(function(){d.rc(t);const i=e.$implicit;return d.ec(2).unfilter("storeId",i)})),d.Sb(1,"mat-icon"),d.Cc(2," store "),d.Rb(),d.Sb(3,"mat-label"),d.Cc(4),d.Rb(),d.Sb(5,"mat-icon",17),d.Cc(6," cancel "),d.Rb(),d.Rb()}if(2&t){const t=e.$implicit,i=d.ec(2);d.Ab(4),d.Ec(" ",i.describe(i.stores.data,"storeId",t)," ")}}function L(t,e){if(1&t&&(d.Sb(0,"mat-chip-list",14),d.Ac(1,j,7,1,"mat-chip",15),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.kc("ngForOf",t.filter.storeId)}}function G(t,e){1&t&&d.Nb(0,"th",18)}function $(t,e){if(1&t&&(d.Sb(0,"td",19),d.Nb(1,"img",20),d.Rb()),2&t){const t=e.$implicit;d.Ab(1),d.kc("src",t.image,d.tc)}}function D(t,e){1&t&&(d.Sb(0,"th",21),d.Cc(1," Title "),d.Rb())}function F(t,e){if(1&t&&(d.Sb(0,"td",19),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.Ab(1),d.Ec(" ",t.title," ")}}function B(t,e){1&t&&(d.Sb(0,"th",21),d.Cc(1," Price "),d.Rb())}function Q(t,e){if(1&t&&(d.Sb(0,"small"),d.Cc(1),d.fc(2,"currency"),d.Rb()),2&t){const t=d.ec().$implicit;d.Ab(1),d.Ec(" ",d.hc(2,1,t.price,"R")," ")}}function J(t,e){if(1&t&&(d.Sb(0,"td",19),d.Cc(1),d.fc(2,"currency"),d.fc(3,"currency"),d.Ac(4,Q,3,4,"small",22),d.Rb()),2&t){const t=e.$implicit;d.Ab(1),d.Ec(" ",t.promotion.enabled?d.hc(2,2,t.promotion.price,"R"):d.hc(3,5,t.price,"R")," "),d.Ab(3),d.kc("ngIf",t.promotion.enabled)}}function W(t,e){1&t&&(d.Sb(0,"th",21),d.Cc(1," Quantity "),d.Rb())}function Z(t,e){if(1&t&&(d.Sb(0,"td",19),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.Ab(1),d.Ec(" ",t.quantity," ")}}function K(t,e){1&t&&d.Nb(0,"th",18)}function U(t,e){if(1&t){const t=d.Tb();d.Sb(0,"td",19),d.Sb(1,"button",23),d.ac("click",(function(){d.rc(t);const i=e.$implicit;return d.ec().options(i)})),d.Sb(2,"mat-icon"),d.Cc(3," more_vert "),d.Rb(),d.Rb(),d.Rb()}}function X(t,e){1&t&&d.Nb(0,"tr",24)}function Y(t,e){1&t&&d.Nb(0,"tr",25)}let tt=(()=>{class t{constructor(t,e,i,o,r,s,n,a,c,d){this.toast=t,this.dialog=e,this.stores=i,this.sheet=o,this.filters=r,this.confirm=s,this.router=n,this.service=a,this.buttons=c,this.localstorage=d,this.filter=this.filters.get({storeId:[]}),this.columns=["image","title","price","quantity","options"],this.products=new l.o,this.subscriptions={}}list(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({sort:{description:1},filter:["role","title","image","price","quantity","promotion","productId"],storeId:this.filter.storeId});this.products.data=t.ok?t.result.map(t=>new s.a(t)):[],this.loading=!1}))}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({filter:["storeId","description"]});this.stores.data=t.ok?t.result.map(t=>new r.a(t)):[],this.loading=!1}))}unfilter(t,e){this.filter[t]=this.filter[t].filter(t=>t!=e),this.filters.update(this.filter),this.list()}options(t){return Object(o.a)(this,void 0,void 0,(function*(){this.sheet.show({role:t.role,title:t.description,options:[{icon:"edit",title:"Edit Product",handler:()=>{this.router.navigate(["/products","editor"],{queryParams:{mode:"update",productId:t.productId}})},disabled:[0,1]},{icon:"content_copy",title:"Copy Product",handler:()=>{this.router.navigate(["/products","editor"],{queryParams:{mode:"copy",productId:t.productId}})},disabled:[0,1]},{icon:"delete",title:"Delete",danger:!0,handler:()=>{this.confirm.show({message:"Delete "+t.description,handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.service.delete({productId:t.productId});if(e.ok){for(let e=0;e<this.products.data.length;e++)if(this.products.data[e].productId==t.productId){this.products.data.splice(e,1);break}this.products.data=this.products.data.map(t=>new s.a(t)),this.toast.success("Product was removed!")}else this.toast.error(e.error.message);this.loading=!1}))})},disabled:[0,1]}]})}))}describe(t,e,i){let o="-";return t.map(t=>{t[e]==i&&(o=t.description)}),o}ngOnInit(){this.buttons.show("add"),this.buttons.hide("close"),this.buttons.show("filter"),this.buttons.show("search"),this.sort.active="description",this.sort.direction="desc",this.products.sort=this.sort,this.subscriptions.add=this.buttons.add.click.subscribe(t=>{this.router.navigate(["/products","editor"],{queryParams:{mode:"add"}})}),this.subscriptions.filter=this.buttons.filter.click.subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){const t=yield this.dialog.open(x,{data:this.filter,panelClass:"filter-dialog"});yield t.afterClosed().subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){t&&(Object.keys(t).map(e=>{this.filter[e]=t[e]}),this.filters.update(this.filter),this.list())})))}))),this.subscriptions.search=this.buttons.search.value.subscribe(t=>{this.products.filter=t}),(()=>{Object(o.a)(this,void 0,void 0,(function*(){yield this.list(),yield this.load()}))})()}ngOnDestroy(){this.buttons.reset("search"),this.subscriptions.add.unsubscribe(),this.subscriptions.filter.unsubscribe(),this.subscriptions.search.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(E.a),d.Mb(c.b),d.Mb(u.a),d.Mb(_.a),d.Mb(q.a),d.Mb(O.a),d.Mb(M.b),d.Mb(V.a),d.Mb(T.a),d.Mb(N.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["products-page"]],viewQuery:function(t,e){var i;1&t&&d.wc(n.a,!0),2&t&&d.oc(i=d.bc())&&(e.sort=i.first)},decls:21,vars:6,consts:[["mode","indeterminate",4,"ngIf"],["class","filterbar",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","image"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","title"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","price"],["matColumnDef","quantity"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mode","indeterminate"],[1,"filterbar"],[3,"removed",4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""],["mat-header-cell",""],["mat-cell",""],["alt","image","width","40","height","40",3,"src"],["mat-header-cell","","mat-sort-header",""],[4,"ngIf"],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(d.Sb(0,"mat-content"),d.Ac(1,z,1,0,"mat-progress-bar",0),d.Ac(2,L,2,1,"mat-chip-list",1),d.Sb(3,"table",2),d.Qb(4,3),d.Ac(5,G,1,0,"th",4),d.Ac(6,$,2,1,"td",5),d.Pb(),d.Qb(7,6),d.Ac(8,D,2,0,"th",7),d.Ac(9,F,2,1,"td",5),d.Pb(),d.Qb(10,8),d.Ac(11,B,2,0,"th",7),d.Ac(12,J,5,8,"td",5),d.Pb(),d.Qb(13,9),d.Ac(14,W,2,0,"th",7),d.Ac(15,Z,2,1,"td",5),d.Pb(),d.Qb(16,10),d.Ac(17,K,1,0,"th",4),d.Ac(18,U,4,0,"td",5),d.Pb(),d.Ac(19,X,1,0,"tr",11),d.Ac(20,Y,1,0,"tr",12),d.Rb(),d.Rb()),2&t&&(d.Ab(1),d.kc("ngIf",e.loading),d.Ab(1),d.kc("ngIf",e.filter.storeId.length>0),d.Ab(1),d.kc("dataSource",e.products),d.Ab(16),d.kc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),d.Ab(1),d.kc("matRowDefColumns",e.columns))},directives:[g.a,C.m,l.n,n.a,l.c,l.i,l.b,l.k,l.m,P.a,H.c,C.l,H.a,f.a,b.f,H.d,l.h,l.a,n.b,p.a,l.j,l.l],pipes:[C.d],styles:[".mat-column-image[_ngcontent-%COMP%]{width:60px}.mat-column-price[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{text-decoration:line-through}"]}),t})();var et=i("x0BX"),it=i("36gI"),ot=i("ZVi7"),rt=i("G0b6"),st=i("qFsG"),nt=i("8LU1"),lt=i("cH1L");const at=["*"],ct=".mat-grid-list{display:block;position:relative}.mat-grid-tile{display:block;position:absolute;overflow:hidden}.mat-grid-tile .mat-figure{top:0;left:0;right:0;bottom:0;position:absolute;display:flex;align-items:center;justify-content:center;height:100%;padding:0;margin:0}.mat-grid-tile .mat-grid-tile-header,.mat-grid-tile .mat-grid-tile-footer{display:flex;align-items:center;height:48px;color:#fff;background:rgba(0,0,0,.38);overflow:hidden;padding:0 16px;position:absolute;left:0;right:0}.mat-grid-tile .mat-grid-tile-header>*,.mat-grid-tile .mat-grid-tile-footer>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-grid-tile .mat-grid-tile-header.mat-2-line,.mat-grid-tile .mat-grid-tile-footer.mat-2-line{height:68px}.mat-grid-tile .mat-grid-list-text{display:flex;flex-direction:column;flex:auto;box-sizing:border-box;overflow:hidden}.mat-grid-tile .mat-grid-list-text>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-grid-tile .mat-grid-list-text:empty{display:none}.mat-grid-tile .mat-grid-tile-header{top:0}.mat-grid-tile .mat-grid-tile-footer{bottom:0}.mat-grid-tile .mat-grid-avatar{padding-right:16px}[dir=rtl] .mat-grid-tile .mat-grid-avatar{padding-right:0;padding-left:16px}.mat-grid-tile .mat-grid-avatar:empty{display:none}\n",dt=new d.r("MAT_GRID_LIST");let ut=(()=>{class t{constructor(t,e){this._element=t,this._gridList=e,this._rowspan=1,this._colspan=1}get rowspan(){return this._rowspan}set rowspan(t){this._rowspan=Math.round(Object(nt.f)(t))}get colspan(){return this._colspan}set colspan(t){this._colspan=Math.round(Object(nt.f)(t))}_setStyle(t,e){this._element.nativeElement.style[t]=e}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(d.l),d.Mb(dt,8))},t.\u0275cmp=d.Gb({type:t,selectors:[["mat-grid-tile"]],hostAttrs:[1,"mat-grid-tile"],hostVars:2,hostBindings:function(t,e){2&t&&d.Bb("rowspan",e.rowspan)("colspan",e.colspan)},inputs:{rowspan:"rowspan",colspan:"colspan"},exportAs:["matGridTile"],ngContentSelectors:at,decls:2,vars:0,consts:[[1,"mat-figure"]],template:function(t,e){1&t&&(d.jc(),d.Sb(0,"figure",0),d.ic(1),d.Rb())},styles:[ct],encapsulation:2,changeDetection:0}),t})();class ht{constructor(){this.columnIndex=0,this.rowIndex=0}get rowCount(){return this.rowIndex+1}get rowspan(){const t=Math.max(...this.tracker);return t>1?this.rowCount+t-1:this.rowCount}update(t,e){this.columnIndex=0,this.rowIndex=0,this.tracker=new Array(t),this.tracker.fill(0,0,this.tracker.length),this.positions=e.map(t=>this._trackTile(t))}_trackTile(t){const e=this._findMatchingGap(t.colspan);return this._markTilePosition(e,t),this.columnIndex=e+t.colspan,new mt(this.rowIndex,e)}_findMatchingGap(t){let e=-1,i=-1;do{this.columnIndex+t>this.tracker.length?(this._nextRow(),e=this.tracker.indexOf(0,this.columnIndex),i=this._findGapEndIndex(e)):(e=this.tracker.indexOf(0,this.columnIndex),-1!=e?(i=this._findGapEndIndex(e),this.columnIndex=e+1):(this._nextRow(),e=this.tracker.indexOf(0,this.columnIndex),i=this._findGapEndIndex(e)))}while(i-e<t||0==i);return Math.max(e,0)}_nextRow(){this.columnIndex=0,this.rowIndex++;for(let t=0;t<this.tracker.length;t++)this.tracker[t]=Math.max(0,this.tracker[t]-1)}_findGapEndIndex(t){for(let e=t+1;e<this.tracker.length;e++)if(0!=this.tracker[e])return e;return this.tracker.length}_markTilePosition(t,e){for(let i=0;i<e.colspan;i++)this.tracker[t+i]=e.rowspan}}class mt{constructor(t,e){this.row=t,this.col=e}}const bt=/^-?\d+((\.\d+)?[A-Za-z%$]?)+$/;class pt{constructor(){this._rows=0,this._rowspan=0}init(t,e,i,o){this._gutterSize=St(t),this._rows=e.rowCount,this._rowspan=e.rowspan,this._cols=i,this._direction=o}getBaseTileSize(t,e){return`(${t}% - (${this._gutterSize} * ${e}))`}getTilePosition(t,e){return 0===e?"0":yt(`(${t} + ${this._gutterSize}) * ${e}`)}getTileSize(t,e){return`(${t} * ${e}) + (${e-1} * ${this._gutterSize})`}setStyle(t,e,i){let o=100/this._cols,r=(this._cols-1)/this._cols;this.setColStyles(t,i,o,r),this.setRowStyles(t,e,o,r)}setColStyles(t,e,i,o){let r=this.getBaseTileSize(i,o);t._setStyle("rtl"===this._direction?"right":"left",this.getTilePosition(r,e)),t._setStyle("width",yt(this.getTileSize(r,t.colspan)))}getGutterSpan(){return`${this._gutterSize} * (${this._rowspan} - 1)`}getTileSpan(t){return`${this._rowspan} * ${this.getTileSize(t,1)}`}getComputedHeight(){return null}}class ft extends pt{constructor(t){super(),this.fixedRowHeight=t}init(t,e,i,o){super.init(t,e,i,o),this.fixedRowHeight=St(this.fixedRowHeight),bt.test(this.fixedRowHeight)}setRowStyles(t,e){t._setStyle("top",this.getTilePosition(this.fixedRowHeight,e)),t._setStyle("height",yt(this.getTileSize(this.fixedRowHeight,t.rowspan)))}getComputedHeight(){return["height",yt(`${this.getTileSpan(this.fixedRowHeight)} + ${this.getGutterSpan()}`)]}reset(t){t._setListStyle(["height",null]),t._tiles&&t._tiles.forEach(t=>{t._setStyle("top",null),t._setStyle("height",null)})}}class gt extends pt{constructor(t){super(),this._parseRatio(t)}setRowStyles(t,e,i,o){this.baseTileHeight=this.getBaseTileSize(i/this.rowHeightRatio,o),t._setStyle("marginTop",this.getTilePosition(this.baseTileHeight,e)),t._setStyle("paddingTop",yt(this.getTileSize(this.baseTileHeight,t.rowspan)))}getComputedHeight(){return["paddingBottom",yt(`${this.getTileSpan(this.baseTileHeight)} + ${this.getGutterSpan()}`)]}reset(t){t._setListStyle(["paddingBottom",null]),t._tiles.forEach(t=>{t._setStyle("marginTop",null),t._setStyle("paddingTop",null)})}_parseRatio(t){const e=t.split(":");this.rowHeightRatio=parseFloat(e[0])/parseFloat(e[1])}}class vt extends pt{setRowStyles(t,e){let i=this.getBaseTileSize(100/this._rowspan,(this._rows-1)/this._rows);t._setStyle("top",this.getTilePosition(i,e)),t._setStyle("height",yt(this.getTileSize(i,t.rowspan)))}reset(t){t._tiles&&t._tiles.forEach(t=>{t._setStyle("top",null),t._setStyle("height",null)})}}function yt(t){return`calc(${t})`}function St(t){return t.match(/([A-Za-z%]+)$/)?t:t+"px"}let Ct=(()=>{class t{constructor(t,e){this._element=t,this._dir=e,this._gutter="1px"}get cols(){return this._cols}set cols(t){this._cols=Math.max(1,Math.round(Object(nt.f)(t)))}get gutterSize(){return this._gutter}set gutterSize(t){this._gutter=""+(null==t?"":t)}get rowHeight(){return this._rowHeight}set rowHeight(t){const e=""+(null==t?"":t);e!==this._rowHeight&&(this._rowHeight=e,this._setTileStyler(this._rowHeight))}ngOnInit(){this._checkCols(),this._checkRowHeight()}ngAfterContentChecked(){this._layoutTiles()}_checkCols(){}_checkRowHeight(){this._rowHeight||this._setTileStyler("1:1")}_setTileStyler(t){this._tileStyler&&this._tileStyler.reset(this),this._tileStyler="fit"===t?new vt:t&&t.indexOf(":")>-1?new gt(t):new ft(t)}_layoutTiles(){this._tileCoordinator||(this._tileCoordinator=new ht);const t=this._tileCoordinator,e=this._tiles.filter(t=>!t._gridList||t._gridList===this),i=this._dir?this._dir.value:"ltr";this._tileCoordinator.update(this.cols,e),this._tileStyler.init(this.gutterSize,t,this.cols,i),e.forEach((e,i)=>{const o=t.positions[i];this._tileStyler.setStyle(e,o.row,o.col)}),this._setListStyle(this._tileStyler.getComputedHeight())}_setListStyle(t){t&&(this._element.nativeElement.style[t[0]]=t[1])}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(d.l),d.Mb(lt.b,8))},t.\u0275cmp=d.Gb({type:t,selectors:[["mat-grid-list"]],contentQueries:function(t,e,i){var o;1&t&&d.Fb(i,ut,!0),2&t&&d.oc(o=d.bc())&&(e._tiles=o)},hostAttrs:[1,"mat-grid-list"],hostVars:1,hostBindings:function(t,e){2&t&&d.Bb("cols",e.cols)},inputs:{cols:"cols",gutterSize:"gutterSize",rowHeight:"rowHeight"},exportAs:["matGridList"],features:[d.zb([{provide:dt,useExisting:t}])],ngContentSelectors:at,decls:2,vars:0,template:function(t,e){1&t&&(d.jc(),d.Sb(0,"div"),d.ic(1),d.Rb())},styles:[ct],encapsulation:2,changeDetection:0}),t})(),Rt=(()=>{class t{}return t.\u0275mod=d.Kb({type:t}),t.\u0275inj=d.Jb({factory:function(e){return new(e||t)},imports:[[y.j,y.h],y.j,y.h]}),t})();var wt=i("jhN1");const kt=[[["","quill-editor-toolbar",""]]],At=["[quill-editor-toolbar]"],It={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image","video"]]},xt=(t,e)=>t||e||"html",Et=new d.r("config");let _t=(()=>{class t{constructor(t){this.config=t,this.count=0,this.config||(this.config={modules:It})}getQuill(){return this.count++,this.Quill||1!==this.count||(this.$importPromise=new Promise(t=>Object(o.a)(this,void 0,void 0,(function*(){var e,o;const r=yield i.e(21).then(i.t.bind(null,"kzlf",7));this.Quill=r.default?r.default:r,null===(e=this.config.customOptions)||void 0===e||e.forEach(t=>{const e=this.Quill.import(t.import);e.whitelist=t.whitelist,this.Quill.register(e,!0,this.config.suppressGlobalRegisterWarning)}),null===(o=this.config.customModules)||void 0===o||o.forEach(({implementation:t,path:e})=>{this.Quill.register(e,t,this.config.suppressGlobalRegisterWarning)}),t(this.Quill)})))),this.$importPromise}}return t.\u0275fac=function(e){return new(e||t)(d.Wb(Et))},t.\u0275prov=Object(d.Ib)({factory:function(){return new t(Object(d.Wb)(Et))},token:t,providedIn:"root"}),t})(),qt=(()=>{class t{constructor(t,e,i,o,r,s,n){this.elementRef=t,this.domSanitizer=e,this.doc=i,this.platformId=o,this.renderer=r,this.zone=s,this.service=n,this.required=!1,this.customToolbarPosition="top",this.sanitize=!1,this.styles=null,this.strict=!0,this.customOptions=[],this.customModules=[],this.preserveWhitespace=!1,this.trimOnValidation=!1,this.compareValues=!1,this.filterNull=!1,this.onEditorCreated=new d.o,this.onEditorChanged=new d.o,this.onContentChanged=new d.o,this.onSelectionChanged=new d.o,this.onFocus=new d.o,this.onBlur=new d.o,this.disabled=!1,this.valueGetter=(t,e)=>{let i=e.querySelector(".ql-editor").innerHTML;"<p><br></p>"!==i&&"<div><br></div>"!==i||(i=null);let o=i;const r=xt(this.format,this.service.config.format);if("text"===r)o=t.getText();else if("object"===r)o=t.getContents();else if("json"===r)try{o=JSON.stringify(t.getContents())}catch(s){o=t.getText()}return o},this.valueSetter=(t,e)=>{const i=xt(this.format,this.service.config.format);if("html"===i)return this.sanitize&&(e=this.domSanitizer.sanitize(d.J.HTML,e)),t.clipboard.convert(e);if("json"===i)try{return JSON.parse(e)}catch(o){return[{insert:e}]}return e},this.selectionChangeHandler=(t,e,i)=>{const o=!t&&!!this.onModelTouched;(this.onBlur.observers.length||this.onFocus.observers.length||this.onSelectionChanged.observers.length||o)&&this.zone.run(()=>{null===t?this.onBlur.emit({editor:this.quillEditor,source:i}):null===e&&this.onFocus.emit({editor:this.quillEditor,source:i}),this.onSelectionChanged.emit({editor:this.quillEditor,oldRange:e,range:t,source:i}),o&&this.onModelTouched()})},this.textChangeHandler=(t,e,i)=>{const o=this.quillEditor.getText(),r=this.quillEditor.getContents();let s=this.editorElem.querySelector(".ql-editor").innerHTML;"<p><br></p>"!==s&&"<div><br></div>"!==s||(s=null);const n=this.trackChanges||this.service.config.trackChanges,l=("user"===i||n&&"all"===n)&&!!this.onModelChange;(this.onContentChanged.observers.length||l)&&this.zone.run(()=>{l&&this.onModelChange(this.valueGetter(this.quillEditor,this.editorElem)),this.onContentChanged.emit({content:r,delta:t,editor:this.quillEditor,html:s,oldDelta:e,source:i,text:o})})},this.editorChangeHandler=(t,e,i,o)=>{if(this.onEditorChanged.observers.length)if("text-change"===t){const r=this.quillEditor.getText(),s=this.quillEditor.getContents();let n=this.editorElem.querySelector(".ql-editor").innerHTML;"<p><br></p>"!==n&&"<div><br></div>"!==n||(n=null),this.zone.run(()=>{this.onEditorChanged.emit({content:s,delta:e,editor:this.quillEditor,event:t,html:n,oldDelta:i,source:o,text:r})})}else this.onEditorChanged.emit({editor:this.quillEditor,event:t,oldRange:i,range:e,source:o})}}static normalizeClassNames(t){return t.trim().split(" ").reduce((t,e)=>{const i=e.trim();return i&&t.push(i),t},[])}ngAfterViewInit(){return Object(o.a)(this,void 0,void 0,(function*(){if(Object(C.v)(this.platformId))return;const t=yield this.service.getQuill();this.elementRef.nativeElement.insertAdjacentHTML("top"===this.customToolbarPosition?"beforeend":"afterbegin",this.preserveWhitespace?"<pre quill-editor-element></pre>":"<div quill-editor-element></div>"),this.editorElem=this.elementRef.nativeElement.querySelector("[quill-editor-element]");const e=this.elementRef.nativeElement.querySelector("[quill-editor-toolbar]"),i=Object.assign({},this.modules||this.service.config.modules);e?i.toolbar=e:void 0===i.toolbar&&(i.toolbar=It.toolbar);let o=void 0!==this.placeholder?this.placeholder:this.service.config.placeholder;void 0===o&&(o="Insert text here ..."),this.styles&&Object.keys(this.styles).forEach(t=>{this.renderer.setStyle(this.editorElem,t,this.styles[t])}),this.classes&&this.addClasses(this.classes),this.customOptions.forEach(e=>{const i=t.import(e.import);i.whitelist=e.whitelist,t.register(i,!0)}),this.customModules.forEach(({implementation:e,path:i})=>{t.register(i,e)});let r=this.bounds&&"self"===this.bounds?this.editorElem:this.bounds;r||(r=this.service.config.bounds?this.service.config.bounds:this.doc.body);let s=this.debug;!s&&!1!==s&&this.service.config.debug&&(s=this.service.config.debug);let n=this.readOnly;n||!1===this.readOnly||(n=void 0!==this.service.config.readOnly&&this.service.config.readOnly);let l=this.scrollingContainer;l||null===this.scrollingContainer||(l=null===this.service.config.scrollingContainer||this.service.config.scrollingContainer?this.service.config.scrollingContainer:null);let a=this.formats;if(a||void 0!==a||(a=this.service.config.formats?[...this.service.config.formats]:null===this.service.config.formats?null:void 0),this.zone.runOutsideAngular(()=>{var e,c,d;if(this.quillEditor=new t(this.editorElem,{bounds:r,debug:s,formats:a,modules:i,placeholder:o,readOnly:n,scrollingContainer:l,strict:this.strict,theme:this.theme||(this.service.config.theme?this.service.config.theme:"snow")}),this.linkPlaceholder){const t=null===(c=null===(e=this.quillEditor)||void 0===e?void 0:e.theme)||void 0===c?void 0:c.tooltip,i=null===(d=null==t?void 0:t.root)||void 0===d?void 0:d.querySelector("input[data-link]");(null==i?void 0:i.dataset)&&(i.dataset.link=this.linkPlaceholder)}}),this.content){if("text"===xt(this.format,this.service.config.format))this.quillEditor.setText(this.content,"silent");else{const t=this.valueSetter(this.quillEditor,this.content);this.quillEditor.setContents(t,"silent")}this.quillEditor.getModule("history").clear()}this.setDisabledState(),this.quillEditor.on("editor-change",this.editorChangeHandler),this.quillEditor.on("selection-change",this.selectionChangeHandler),this.quillEditor.on("text-change",this.textChangeHandler),setTimeout(()=>{this.onValidatorChanged&&this.onValidatorChanged(),this.onEditorCreated.emit(this.quillEditor)})}))}ngOnDestroy(){this.quillEditor&&(this.quillEditor.off("selection-change",this.selectionChangeHandler),this.quillEditor.off("text-change",this.textChangeHandler),this.quillEditor.off("editor-change",this.editorChangeHandler))}ngOnChanges(t){if(this.quillEditor){if(t.readOnly&&this.quillEditor.enable(!t.readOnly.currentValue),t.placeholder&&(this.quillEditor.root.dataset.placeholder=t.placeholder.currentValue),t.styles){const e=t.styles.currentValue,i=t.styles.previousValue;i&&Object.keys(i).forEach(t=>{this.renderer.removeStyle(this.editorElem,t)}),e&&Object.keys(e).forEach(t=>{this.renderer.setStyle(this.editorElem,t,this.styles[t])})}if(t.classes){const e=t.classes.currentValue,i=t.classes.previousValue;i&&this.removeClasses(i),e&&this.addClasses(e)}}}addClasses(e){t.normalizeClassNames(e).forEach(t=>{this.renderer.addClass(this.editorElem,t)})}removeClasses(e){t.normalizeClassNames(e).forEach(t=>{this.renderer.removeClass(this.editorElem,t)})}writeValue(t){if(this.filterNull&&null===t)return;if(this.content=t,!this.quillEditor)return;const e=xt(this.format,this.service.config.format),i=this.valueSetter(this.quillEditor,t);if(this.compareValues){const t=this.quillEditor.getContents();if(JSON.stringify(t)===JSON.stringify(i))return}t?"text"===e?this.quillEditor.setText(t):this.quillEditor.setContents(i):this.quillEditor.setText("")}setDisabledState(t=this.disabled){this.disabled=t,this.quillEditor&&(t?(this.quillEditor.disable(),this.renderer.setAttribute(this.elementRef.nativeElement,"disabled","disabled")):(this.readOnly||this.quillEditor.enable(),this.renderer.removeAttribute(this.elementRef.nativeElement,"disabled")))}registerOnChange(t){this.onModelChange=t}registerOnTouched(t){this.onModelTouched=t}registerOnValidatorChange(t){this.onValidatorChanged=t}validate(){if(!this.quillEditor)return null;const t={};let e=!0;const i=this.quillEditor.getText(),o=this.trimOnValidation?i.trim().length:1===i.length&&0===i.trim().length?0:i.length-1;return this.minLength&&o&&o<this.minLength&&(t.minLengthError={given:o,minLength:this.minLength},e=!1),this.maxLength&&o>this.maxLength&&(t.maxLengthError={given:o,maxLength:this.maxLength},e=!1),this.required&&!o&&(t.requiredError={empty:!0},e=!1),e?null:t}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(d.l),d.Mb(wt.b),d.Mb(C.e),d.Mb(d.C),d.Mb(d.F),d.Mb(d.A),d.Mb(_t))},t.\u0275dir=d.Hb({type:t,inputs:{required:"required",customToolbarPosition:"customToolbarPosition",sanitize:"sanitize",styles:"styles",strict:"strict",customOptions:"customOptions",customModules:"customModules",preserveWhitespace:"preserveWhitespace",trimOnValidation:"trimOnValidation",compareValues:"compareValues",filterNull:"filterNull",valueGetter:"valueGetter",valueSetter:"valueSetter",format:"format",theme:"theme",modules:"modules",debug:"debug",readOnly:"readOnly",placeholder:"placeholder",maxLength:"maxLength",minLength:"minLength",formats:"formats",scrollingContainer:"scrollingContainer",bounds:"bounds",trackChanges:"trackChanges",classes:"classes",linkPlaceholder:"linkPlaceholder"},outputs:{onEditorCreated:"onEditorCreated",onEditorChanged:"onEditorChanged",onContentChanged:"onContentChanged",onSelectionChanged:"onSelectionChanged",onFocus:"onFocus",onBlur:"onBlur"},features:[d.yb]}),t})(),Ot=(()=>{class t extends qt{constructor(t,e,i,o,r,s,n){super(t,e,i,o,r,s,n)}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(d.l),d.Mb(wt.b),d.Mb(C.e),d.Mb(d.C),d.Mb(d.F),d.Mb(d.A),d.Mb(_t))},t.\u0275cmp=d.Gb({type:t,selectors:[["quill-editor"]],features:[d.zb([{multi:!0,provide:a.k,useExisting:Object(d.U)(()=>t)},{multi:!0,provide:a.j,useExisting:Object(d.U)(()=>t)}]),d.xb],ngContentSelectors:At,decls:1,vars:0,template:function(t,e){1&t&&(d.jc(kt),d.ic(0))},encapsulation:2}),t})(),Mt=(()=>{class t{static forRoot(e){return{ngModule:t,providers:[{provide:Et,useValue:e}]}}}return t.\u0275mod=d.Kb({type:t}),t.\u0275inj=d.Jb({factory:function(e){return new(e||t)},providers:[_t],imports:[[C.c]]}),t})();var Vt=i("ZRfb"),Tt=i("in+p");function Nt(t,e){1&t&&d.Nb(0,"mat-progress-bar",43)}function Pt(t,e){if(1&t){const t=d.Tb();d.Sb(0,"mat-grid-tile",44),d.ac("upload-change",(function(e){return d.rc(t),d.ec().AddImage(e)})),d.Sb(1,"mat-icon"),d.Cc(2," upload "),d.Rb(),d.Rb()}if(2&t){const t=d.ec();d.kc("upload-src",t.image)}}function Ht(t,e){if(1&t){const t=d.Tb();d.Sb(0,"mat-grid-tile",44),d.ac("upload-change",(function(i){d.rc(t);const o=e.$implicit;return d.ec().UpdateImage(o,i)})),d.Sb(1,"button",45),d.ac("click",(function(i){d.rc(t);const o=e.$implicit;return d.ec().MainImage(i,o)})),d.Sb(2,"mat-icon"),d.Cc(3," star "),d.Rb(),d.Rb(),d.Sb(4,"button",46),d.ac("click",(function(i){d.rc(t);const o=e.$implicit;return d.ec().RemoveImage(i,o)})),d.Sb(5,"mat-icon"),d.Cc(6," delete "),d.Rb(),d.Rb(),d.Rb()}if(2&t){const t=e.$implicit;d.kc("upload-src",t.src),d.Ab(1),d.Eb("active",t.main)}}function zt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.expiry.enabled," ")}}function jt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.expiry.date," ")}}function Lt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.location.enabled," ")}}function Gt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.location.latitude," ")}}function $t(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.location.longitude," ")}}function Dt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.promotion.enabled," ")}}function Ft(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.promotion.price," ")}}function Bt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.cost," ")}}function Qt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.type," ")}}function Jt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.title," ")}}function Wt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.price," ")}}function Zt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.visible," ")}}function Kt(t,e){if(1&t&&(d.Sb(0,"mat-option",11),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.productId),d.Ab(1),d.Ec(" ",t.title," ")}}function Ut(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.links," ")}}function Xt(t,e){if(1&t&&(d.Sb(0,"mat-option",47),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.storeId)("disabled",t.role<2),d.Ab(1),d.Ec(" ",t.description," ")}}function Yt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.storeId," ")}}function te(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec(2);d.Ab(1),d.Ec(" ",t.errors.quantity," ")}}function ee(t,e){if(1&t&&(d.Sb(0,"mat-form-field",9),d.Sb(1,"mat-label"),d.Cc(2," Quantity "),d.Rb(),d.Nb(3,"input",48),d.Ac(4,te,2,1,"mat-error",12),d.Rb()),2&t){const t=d.ec();d.Ab(3),d.kc("required","voucher"!=t.form.value.type),d.Ab(1),d.kc("ngIf",t.errors.quantity)}}function ie(t,e){if(1&t&&(d.Sb(0,"mat-option",11),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.supplierId),d.Ab(1),d.Ec(" ",t.description," ")}}function oe(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.supplierId," ")}}function re(t,e){if(1&t&&(d.Sb(0,"mat-option",11),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.departmentId),d.Ab(1),d.Ec(" ",t.description," ")}}function se(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.departments," ")}}const ne=function(t){return{title:t}},le=function(t){return{description:t}};let ae=(()=>{class t{constructor(t,e,i,o,r,n,c,d,u){this.toast=t,this.route=e,this.stores=i,this.router=o,this.products=r,this.buttons=n,this.formerror=c,this.suppliers=d,this.departments=u,this.form=new a.f({expiry:new a.f({date:new a.c(null),enabled:new a.c(null,[a.t.required])}),location:new a.f({enabled:new a.c(null,[a.t.required]),latitude:new a.c(null),longitude:new a.c(null)}),promotion:new a.f({price:new a.c(null,[a.t.required]),enabled:new a.c(null,[a.t.required])}),cost:new a.c(0,[a.t.required]),type:new a.c(null,[a.t.required]),links:new a.c([]),title:new a.c(null,[a.t.required]),price:new a.c(0,[a.t.required]),images:new a.c([],[a.t.required]),visible:new a.c(null,[a.t.required]),storeId:new a.c(null,[a.t.required]),quantity:new a.c(0,[a.t.required]),supplierId:new a.c(null,[a.t.required]),departments:new a.c([]),description:new a.c(null,[a.t.required])}),this.errors={expiry:{date:"",enabled:""},location:{enabled:"",latitude:"",longitude:""},promotion:{price:"",enabled:""},cost:"",info:"",type:"",links:"",title:"",price:"",images:"",visible:"",storeId:"",quantity:"",supplierId:"",departments:"",description:""},this.filter=new a.f({link:new a.c(""),store:new a.c(""),product:new a.c(""),supplier:new a.c(""),department:new a.c("")}),this.options=new l.o,this.product=new s.a,this.subscriptions={}}get(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.products.get({filter:["role","cost","type","links","title","price","expiry","images","visible","storeId","quantity","location","promotion","supplierId","departments","description"],productId:this.productId});t.ok?(this.product=new s.a(t.result),this.product.role>2?(this.form.controls.expiry.controls.date.setValue(this.product.expiry.date),this.form.controls.expiry.controls.enabled.setValue(this.product.expiry.enabled),this.form.controls.location.controls.enabled.setValue(this.product.location.enabled),this.form.controls.location.controls.latitude.setValue(this.product.location.latitude),this.form.controls.location.controls.longitude.setValue(this.product.location.longitude),this.form.controls.promotion.controls.price.setValue(this.product.promotion.price),this.form.controls.promotion.controls.enabled.setValue(this.product.promotion.enabled),this.form.controls.cost.setValue(this.product.cost),this.form.controls.type.setValue(this.product.type),this.form.controls.links.setValue(this.product.links),this.form.controls.title.setValue(this.product.title),this.form.controls.price.setValue(this.product.price),this.form.controls.images.setValue(this.product.images),this.form.controls.visible.setValue(this.product.visible),this.form.controls.storeId.setValue(this.product.storeId),this.form.controls.quantity.setValue(this.product.quantity),this.form.controls.supplierId.setValue(this.product.supplierId),this.form.controls.departments.setValue(this.product.departments),this.form.controls.description.setValue(this.product.description)):(this.toast.error("Your role is not high enough to copy/edit this product!"),this.router.navigate(["/products"]))):(this.toast.error(t.error.message),this.router.navigate(["/products"])),this.loading=!1}))}AddImage(t){let e=this.form.value.images,i={src:t,main:!1,position:e.length};0==e.length&&(i.main=!0),e.push(i),this.form.controls.images.setValue(e),this.image=null}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({sort:{description:1},filter:["role","storeId","description"]});t.ok?this.stores.data=t.result.map(t=>new r.a(t)):(this.stores.data=[],this.toast.error(t.error.message),this.router.navigate(["/products"])),this.loading=!1}))}submit(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add",delete this.productId);const e=yield this.products[t]({expiry:{date:this.form.value.expiry.date,enabled:this.form.value.expiry.enabled},location:{enabled:this.form.value.location.enabled,latitude:this.form.value.location.latitude,longitude:this.form.value.location.longitude},promotion:{price:this.form.value.promotion.price,enabled:this.form.value.promotion.enabled},cost:this.form.value.cost,type:this.form.value.type,links:this.form.value.links,title:this.form.value.title,price:this.form.value.price,images:this.form.value.images,visible:this.form.value.visible,storeId:this.form.value.storeId,quantity:this.form.value.quantity,productId:this.productId,supplierId:this.form.value.supplierId,departments:this.form.value.departments,description:this.form.value.description});e.ok?this.router.navigate(["/products"]):this.toast.error(e.error.message),this.loading=!1}))}UpdateImage(t,e){let i=this.form.value.images;for(let o=0;o<i.length;o++)if(i[o].src==t.src){i[o].src=e;break}this.form.controls.images.setValue(i)}MainImage(t,e){t.preventDefault(),t.stopPropagation();let i=this.form.value.images;i.map(t=>{t.main=!1,t.src==e.src&&(e.main=!0)}),this.form.controls.images.setValue(i)}RemoveImage(t,e){t.preventDefault(),t.stopPropagation();let i=this.form.value.images;for(let o=0;o<i.length;o++)if(i[o].src==e.src){i.splice(o,1);break}this.form.controls.images.setValue(i)}ngOnInit(){this.buttons.hide("add"),this.buttons.show("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.products.data=[],this.suppliers.data=[],this.departments.data=[],this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.subscriptions.close=this.buttons.close.click.subscribe(t=>{this.router.navigate(["/products"])}),this.subscriptions.expiry=this.form.controls.expiry.controls.enabled.valueChanges.subscribe(t=>{t?(this.form.controls.expiry.controls.date.setValidators([a.t.required]),this.form.controls.expiry.controls.date.updateValueAndValidity()):(this.form.controls.expiry.controls.date.setValidators(null),this.form.controls.expiry.controls.date.updateValueAndValidity())}),this.subscriptions.storeId=this.form.controls.storeId.valueChanges.subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){for(let e=0;e<this.stores.data.length;e++)if(this.stores.data[e].storeId==t){this.loading=!0;const e=yield this.products.list({sort:{title:1},filter:["title","productId"],type:"voucher",storeId:t});this.products.data=e.ok?e.result.map(t=>new s.a(t)):[];const i=yield this.suppliers.list({sort:{description:1},filter:["supplierId","description"]});i.ok?this.suppliers.data=i.result.map(t=>new et.a(t)):(this.suppliers.data=[],this.toast.error(i.error.message),this.router.navigate(["/products"]));const o=yield this.departments.list({sort:{description:1},filter:["description","departmentId"]});this.departments.data=o.ok?o.result.map(t=>new it.a(t)):[],this.loading=!1;break}}))),this.subscriptions.location=this.form.controls.location.controls.enabled.valueChanges.subscribe(t=>{t?(this.form.controls.location.controls.latitude.setValidators([a.t.required,a.t.min(-90),a.t.max(90)]),this.form.controls.location.controls.latitude.updateValueAndValidity(),this.form.controls.location.controls.longitude.setValidators([a.t.required,a.t.min(-180),a.t.max(180)]),this.form.controls.location.controls.longitude.updateValueAndValidity()):(this.form.controls.location.controls.latitude.setValidators(null),this.form.controls.location.controls.latitude.updateValueAndValidity(),this.form.controls.location.controls.longitude.setValidators(null),this.form.controls.location.controls.longitude.updateValueAndValidity())}),this.subscriptions.promotion=this.form.controls.promotion.controls.enabled.valueChanges.subscribe(t=>{t?(this.form.controls.promotion.controls.price.setValidators([a.t.required]),this.form.controls.promotion.controls.price.updateValueAndValidity()):(this.form.controls.promotion.controls.price.setValidators(null),this.form.controls.promotion.controls.price.updateValueAndValidity())});const t=this.route.snapshot.queryParams;this.mode=t.mode,this.productId=t.productId,(()=>{Object(o.a)(this,void 0,void 0,(function*(){"add"!=this.mode&&(yield this.get()),yield this.load()}))})()}ngOnDestroy(){this.subscriptions.form.unsubscribe(),this.subscriptions.close.unsubscribe(),this.subscriptions.expiry.unsubscribe(),this.subscriptions.storeId.unsubscribe(),this.subscriptions.location.unsubscribe(),this.subscriptions.promotion.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(E.a),d.Mb(M.a),d.Mb(u.a),d.Mb(M.b),d.Mb(V.a),d.Mb(T.a),d.Mb(h.a),d.Mb(ot.a),d.Mb(rt.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["products-editor-page"]],decls:150,vars:73,consts:[["mode","indeterminate",4,"ngIf"],[1,"container"],[3,"formGroup","ngSubmit"],["floatLabel","always","appearance","outline"],["matInput","","type","text","formControlName","images","required","",2,"display","none"],["cols","5","rowHeight","1:1"],["upload","","matRipple","",3,"upload-src","upload-change",4,"ngIf"],["upload","","matRipple","",3,"upload-src","upload-change",4,"ngFor","ngForOf"],["formGroupName","expiry"],["appearance","outline"],["name","enabled","placeholder","enabled","formControlName","enabled","required",""],[3,"value"],[4,"ngIf"],["matInput","","type","date","name","date","placeholder","date","formControlName","date",3,"required"],["formGroupName","location"],["matInput","","type","number","min","-90","max","90","name","latitude","placeholder","latitude","formControlName","latitude",3,"required"],["matInput","","type","number","min","-180","max","180","name","longitude","placeholder","longitude","formControlName","longitude",3,"required"],["formGroupName","promotion"],["matInput","","type","number","name","price","placeholder","price","formControlName","price",3,"required"],["matInput","","type","number","name","cost","placeholder","cost","formControlName","cost","required",""],["name","type","placeholder","type","formControlName","type","required",""],["value","virtual"],["value","voucher"],["value","physical"],["matInput","","type","text","name","title","placeholder","title","formControlName","title","required",""],["matInput","","type","number","name","price","placeholder","price","formControlName","price","required",""],["name","visible","placeholder","visible","formControlName","visible","required",""],["name","links","formControlName","links","multiple",""],[3,"formGroup"],["placeholderLabel","filter products","noEntriesFoundLabel","no products found","formControlName","product"],[3,"value",4,"ngFor","ngForOf"],["name","storeId","formControlName","storeId","required",""],["placeholderLabel","filter stores","noEntriesFoundLabel","no stores found","formControlName","store"],[3,"value","disabled",4,"ngFor","ngForOf"],["appearance","outline",4,"ngIf"],["name","supplierId","placeholder","supplierId","formControlName","supplierId","required",""],["placeholderLabel","filter suppliers","noEntriesFoundLabel","no suppliers found","formControlName","supplier"],["name","departments","formControlName","departments","multiple",""],["placeholderLabel","filter departments","noEntriesFoundLabel","no departments found","formControlName","department"],["name","description","formControlName","description","required",""],["type","submit",2,"display","none"],["button",""],["type","button","color","primary","mat-flat-button","",3,"click"],["mode","indeterminate"],["upload","","matRipple","",3,"upload-src","upload-change"],["mat-icon-button","",1,"star",3,"click"],["mat-icon-button","","color","warn",1,"delete",3,"click"],[3,"value","disabled"],["matInput","","type","number","name","quantity","placeholder","quantity","formControlName","quantity",3,"required"]],template:function(t,e){if(1&t){const t=d.Tb();d.Sb(0,"mat-content"),d.Ac(1,Nt,1,0,"mat-progress-bar",0),d.Sb(2,"div",1),d.Sb(3,"form",2),d.ac("ngSubmit",(function(){return!e.form.invalid&&!e.loading&&e.submit()})),d.Sb(4,"mat-form-field",3),d.Sb(5,"mat-label"),d.Cc(6," Images "),d.Rb(),d.Nb(7,"input",4),d.Sb(8,"mat-grid-list",5),d.Ac(9,Pt,3,1,"mat-grid-tile",6),d.Ac(10,Ht,7,3,"mat-grid-tile",7),d.Rb(),d.Rb(),d.Sb(11,"h2"),d.Cc(12," Expiry "),d.Rb(),d.Sb(13,"section",8),d.Sb(14,"mat-form-field",9),d.Sb(15,"mat-label"),d.Cc(16," Enabled "),d.Rb(),d.Sb(17,"mat-select",10),d.Sb(18,"mat-option",11),d.Cc(19," Enabled "),d.Rb(),d.Sb(20,"mat-option",11),d.Cc(21," Disabled "),d.Rb(),d.Rb(),d.Ac(22,zt,2,1,"mat-error",12),d.Rb(),d.Sb(23,"mat-form-field",9),d.Sb(24,"mat-label"),d.Cc(25," Date "),d.Rb(),d.Nb(26,"input",13),d.Ac(27,jt,2,1,"mat-error",12),d.Rb(),d.Rb(),d.Sb(28,"h2"),d.Cc(29," Location "),d.Rb(),d.Sb(30,"section",14),d.Sb(31,"mat-form-field",9),d.Sb(32,"mat-label"),d.Cc(33," Enabled "),d.Rb(),d.Sb(34,"mat-select",10),d.Sb(35,"mat-option",11),d.Cc(36," Enabled "),d.Rb(),d.Sb(37,"mat-option",11),d.Cc(38," Disabled "),d.Rb(),d.Rb(),d.Ac(39,Lt,2,1,"mat-error",12),d.Rb(),d.Rb(),d.Sb(40,"section",14),d.Sb(41,"mat-form-field",9),d.Sb(42,"mat-label"),d.Cc(43," Latitude "),d.Rb(),d.Nb(44,"input",15),d.Ac(45,Gt,2,1,"mat-error",12),d.Rb(),d.Sb(46,"mat-form-field",9),d.Sb(47,"mat-label"),d.Cc(48," Longitude "),d.Rb(),d.Nb(49,"input",16),d.Ac(50,$t,2,1,"mat-error",12),d.Rb(),d.Rb(),d.Sb(51,"h2"),d.Cc(52," Promotion "),d.Rb(),d.Sb(53,"section",17),d.Sb(54,"mat-form-field",9),d.Sb(55,"mat-label"),d.Cc(56," Enabled "),d.Rb(),d.Sb(57,"mat-select",10),d.Sb(58,"mat-option",11),d.Cc(59," Enabled "),d.Rb(),d.Sb(60,"mat-option",11),d.Cc(61," Disabled "),d.Rb(),d.Rb(),d.Ac(62,Dt,2,1,"mat-error",12),d.Rb(),d.Sb(63,"mat-form-field",9),d.Sb(64,"mat-label"),d.Cc(65," Price "),d.Rb(),d.Nb(66,"input",18),d.Ac(67,Ft,2,1,"mat-error",12),d.Rb(),d.Rb(),d.Sb(68,"mat-form-field",9),d.Sb(69,"mat-label"),d.Cc(70," Cost "),d.Rb(),d.Nb(71,"input",19),d.Ac(72,Bt,2,1,"mat-error",12),d.Rb(),d.Sb(73,"mat-form-field",9),d.Sb(74,"mat-label"),d.Cc(75," Type "),d.Rb(),d.Sb(76,"mat-select",20),d.Sb(77,"mat-option",21),d.Cc(78," Virtual "),d.Rb(),d.Sb(79,"mat-option",22),d.Cc(80," Voucher "),d.Rb(),d.Sb(81,"mat-option",23),d.Cc(82," Physical "),d.Rb(),d.Rb(),d.Ac(83,Qt,2,1,"mat-error",12),d.Rb(),d.Sb(84,"mat-form-field",9),d.Sb(85,"mat-label"),d.Cc(86," Title "),d.Rb(),d.Nb(87,"input",24),d.Ac(88,Jt,2,1,"mat-error",12),d.Rb(),d.Sb(89,"mat-form-field",9),d.Sb(90,"mat-label"),d.Cc(91," Price "),d.Rb(),d.Nb(92,"input",25),d.Ac(93,Wt,2,1,"mat-error",12),d.Rb(),d.Sb(94,"mat-form-field",9),d.Sb(95,"mat-label"),d.Cc(96," Visible "),d.Rb(),d.Sb(97,"mat-select",26),d.Sb(98,"mat-option",11),d.Cc(99," Enabled "),d.Rb(),d.Sb(100,"mat-option",11),d.Cc(101," Disabled "),d.Rb(),d.Rb(),d.Ac(102,Zt,2,1,"mat-error",12),d.Rb(),d.Sb(103,"mat-form-field",9),d.Sb(104,"mat-label"),d.Cc(105," Product Links "),d.Rb(),d.Sb(106,"mat-select",27),d.Sb(107,"mat-option",28),d.Nb(108,"ngx-mat-select-search",29),d.Rb(),d.Ac(109,Kt,2,2,"mat-option",30),d.fc(110,"filterBy"),d.fc(111,"orderBy"),d.Rb(),d.Ac(112,Ut,2,1,"mat-error",12),d.Rb(),d.Sb(113,"mat-form-field",9),d.Sb(114,"mat-label"),d.Cc(115," Store "),d.Rb(),d.Sb(116,"mat-select",31),d.Sb(117,"mat-option",28),d.Nb(118,"ngx-mat-select-search",32),d.Rb(),d.Ac(119,Xt,2,3,"mat-option",33),d.fc(120,"filterBy"),d.fc(121,"orderBy"),d.Rb(),d.Ac(122,Yt,2,1,"mat-error",12),d.Rb(),d.Ac(123,ee,5,2,"mat-form-field",34),d.Sb(124,"mat-form-field",9),d.Sb(125,"mat-label"),d.Cc(126," Supplier "),d.Rb(),d.Sb(127,"mat-select",35),d.Sb(128,"mat-option",28),d.Nb(129,"ngx-mat-select-search",36),d.Rb(),d.Ac(130,ie,2,2,"mat-option",30),d.fc(131,"filterBy"),d.fc(132,"orderBy"),d.Rb(),d.Ac(133,oe,2,1,"mat-error",12),d.Rb(),d.Sb(134,"mat-form-field",9),d.Sb(135,"mat-label"),d.Cc(136," Department(s) "),d.Rb(),d.Sb(137,"mat-select",37),d.Sb(138,"mat-option",28),d.Nb(139,"ngx-mat-select-search",38),d.Rb(),d.Ac(140,re,2,2,"mat-option",30),d.fc(141,"filterBy"),d.fc(142,"orderBy"),d.Rb(),d.Ac(143,se,2,1,"mat-error",12),d.Rb(),d.Nb(144,"quill-editor",39),d.Nb(145,"button",40,41),d.Rb(),d.Rb(),d.Rb(),d.Sb(147,"mat-footer"),d.Sb(148,"button",42),d.ac("click",(function(){return d.rc(t),d.pc(146).click()})),d.Cc(149," submit "),d.Rb(),d.Rb()}2&t&&(d.Ab(1),d.kc("ngIf",e.loading),d.Ab(2),d.kc("formGroup",e.form),d.Ab(6),d.kc("ngIf",e.form.value.images.length<5),d.Ab(1),d.kc("ngForOf",e.form.value.images),d.Ab(8),d.kc("value",!0),d.Ab(2),d.kc("value",!1),d.Ab(2),d.kc("ngIf",e.errors.expiry.enabled),d.Ab(4),d.kc("required",e.form.value.expiry.enabled),d.Ab(1),d.kc("ngIf",e.errors.expiry.date),d.Ab(8),d.kc("value",!0),d.Ab(2),d.kc("value",!1),d.Ab(2),d.kc("ngIf",e.errors.location.enabled),d.Ab(5),d.kc("required",e.form.value.location.enabled),d.Ab(1),d.kc("ngIf",e.errors.location.latitude),d.Ab(4),d.kc("required",e.form.value.location.enabled),d.Ab(1),d.kc("ngIf",e.errors.location.longitude),d.Ab(8),d.kc("value",!0),d.Ab(2),d.kc("value",!1),d.Ab(2),d.kc("ngIf",e.errors.promotion.enabled),d.Ab(4),d.kc("required",e.form.value.promotion.enabled),d.Ab(1),d.kc("ngIf",e.errors.promotion.price),d.Ab(5),d.kc("ngIf",e.errors.cost),d.Ab(11),d.kc("ngIf",e.errors.type),d.Ab(5),d.kc("ngIf",e.errors.title),d.Ab(5),d.kc("ngIf",e.errors.price),d.Ab(5),d.kc("value",!0),d.Ab(2),d.kc("value",!1),d.Ab(2),d.kc("ngIf",e.errors.visible),d.Ab(5),d.kc("formGroup",e.filter),d.Ab(2),d.kc("ngForOf",d.hc(110,41,d.hc(111,44,e.products.data,"title"),d.mc(65,ne,e.filter.value.product))),d.Ab(3),d.kc("ngIf",e.errors.links),d.Ab(5),d.kc("formGroup",e.filter),d.Ab(2),d.kc("ngForOf",d.hc(120,47,d.hc(121,50,e.stores.data,"description"),d.mc(67,le,e.filter.value.store))),d.Ab(3),d.kc("ngIf",e.errors.storeId),d.Ab(1),d.kc("ngIf","voucher"!=e.form.value.type),d.Ab(5),d.kc("formGroup",e.filter),d.Ab(2),d.kc("ngForOf",d.hc(131,53,d.hc(132,56,e.suppliers.data,"description"),d.mc(69,le,e.filter.value.supplier))),d.Ab(3),d.kc("ngIf",e.errors.supplierId),d.Ab(5),d.kc("formGroup",e.filter),d.Ab(2),d.kc("ngForOf",d.hc(141,59,d.hc(142,62,e.departments.data,"description"),d.mc(71,le,e.filter.value.department))),d.Ab(3),d.kc("ngIf",e.errors.departments))},directives:[g.a,C.m,a.u,a.n,a.g,b.c,b.f,st.a,a.b,a.m,a.e,a.s,Ct,C.l,a.h,v.a,y.k,a.q,S.a,Ot,Vt.a,p.a,P.a,ut,Tt.a,y.o,f.a,b.b],pipes:[R.a,w.a],styles:[".logo[_ngcontent-%COMP%]{width:150px;height:150px;border:1px solid #e0e0e0;display:flex;margin:20px auto auto;align-items:center;border-radius:5px;justify-content:center;background-color:#fafafa}mat-grid-list[_ngcontent-%COMP%]   mat-grid-tile[_ngcontent-%COMP%]{background-size:contain;background-repeat:no-repeat;background-position:50%}mat-grid-list[_ngcontent-%COMP%]   mat-grid-tile[_ngcontent-%COMP%]   .delete[_ngcontent-%COMP%], mat-grid-list[_ngcontent-%COMP%]   mat-grid-tile[_ngcontent-%COMP%]   .star[_ngcontent-%COMP%]{top:0;z-index:100;position:absolute}mat-grid-list[_ngcontent-%COMP%]   mat-grid-tile[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:#ffc107!important}mat-grid-list[_ngcontent-%COMP%]   mat-grid-tile[_ngcontent-%COMP%]   .star[_ngcontent-%COMP%]{left:0}mat-grid-list[_ngcontent-%COMP%]   mat-grid-tile[_ngcontent-%COMP%]   .delete[_ngcontent-%COMP%]{right:0}"]}),t})();var ce=i("5Yg0"),de=i("gyTc"),ue=i("R32p"),he=i("tVzd"),me=i("J89Z"),be=i("p/0r"),pe=i("H0Zp");const fe=[{path:"",component:tt},{path:"editor",component:ae}];let ge=(()=>{class t{}return t.\u0275mod=d.Kb({type:t}),t.\u0275inj=d.Jb({factory:function(e){return new(e||t)},imports:[[a.i,C.c,ce.a,ue.a,n.c,n.c,de.a,f.b,l.p,H.e,st.b,c.c,me.a,y.p,p.b,v.b,he.a,m.b,be.a,pe.a,Rt,b.e,a.r,P.b,Mt.forRoot(),S.b,M.e.forChild(fe)]]}),t})()}}]);