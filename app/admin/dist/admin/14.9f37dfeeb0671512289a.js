(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{ZGGN:function(t,e,i){"use strict";i.r(e),i.d(e,"DepartmentsPageModule",(function(){return lt}));var r=i("mrSG"),s=i("o3Q1"),o=i("Dh3D"),n=i("36gI"),a=i("+0xr"),c=i("3Pt+"),d=i("0IaG"),l=i("fXoL"),b=i("btHx"),m=i("dWDE"),h=i("/t3+"),u=i("kmnG"),f=i("bTqV"),p=i("NFeN"),g=i("4jEk"),v=i("d3UM"),I=i("FKr1"),S=i("WJ5W"),w=i("ofXK"),R=i("AbOq"),k=i("roMP");function y(t,e){if(1&t&&(l.Sb(0,"mat-option",10),l.Cc(1),l.Rb()),2&t){const t=e.$implicit;l.kc("value",t.storeId),l.Ab(1),l.Ec(" ",t.description," ")}}function A(t,e){if(1&t&&(l.Sb(0,"mat-error"),l.Cc(1),l.Rb()),2&t){const t=l.ec();l.Ab(1),l.Ec(" ",t.errors.storeId," ")}}const C=function(t){return{description:t}};let O=(()=>{class t{constructor(t,e,i,r){this.dialog=t,this.config=e,this.stores=i,this.formerror=r,this.form=new c.f({storeId:new c.c([])}),this.filter=new c.f({store:new c.c("")}),this.errors={storeId:""},this.subscriptions={}}load(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({filter:["storeId","description"]});this.stores.data=t.ok?t.result.map(t=>new s.a(t)):[],void 0!==this.config.storeId&&null!=this.config.storeId&&this.form.controls.storeId.setValue(this.config.storeId),this.loading=!1}))}close(){return Object(r.a)(this,void 0,void 0,(function*(){this.dialog.close(!1)}))}submit(){return Object(r.a)(this,void 0,void 0,(function*(){this.dialog.close(this.form.value)}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.load()}ngOnDestroy(){this.subscriptions.form.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(l.Mb(d.d),l.Mb(d.a),l.Mb(b.a),l.Mb(m.a))},t.\u0275cmp=l.Gb({type:t,selectors:[["departments-filter-dialog"]],decls:20,vars:12,consts:[[1,"spacer"],["mat-icon-button","",3,"click"],[3,"formGroup","ngSubmit"],["appearance","outline"],["name","storeId","formControlName","storeId","multiple",""],[3,"formGroup"],["placeholderLabel","filter stores","noEntriesFoundLabel","no stores found","formControlName","store"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","submit","color","primary","mat-flat-button",""],[3,"value"]],template:function(t,e){1&t&&(l.Sb(0,"mat-toolbar"),l.Sb(1,"mat-label",0),l.Cc(2," Filter Departments "),l.Rb(),l.Sb(3,"button",1),l.ac("click",(function(){return e.close()})),l.Sb(4,"mat-icon"),l.Cc(5," close "),l.Rb(),l.Rb(),l.Rb(),l.Sb(6,"mat-content"),l.Sb(7,"form",2),l.ac("ngSubmit",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),l.Sb(8,"mat-form-field",3),l.Sb(9,"mat-label"),l.Cc(10," Store(s) "),l.Rb(),l.Sb(11,"mat-select",4),l.Sb(12,"mat-option",5),l.Nb(13,"ngx-mat-select-search",6),l.Rb(),l.Ac(14,y,2,2,"mat-option",7),l.fc(15,"filterBy"),l.fc(16,"orderBy"),l.Rb(),l.Ac(17,A,2,1,"mat-error",8),l.Rb(),l.Sb(18,"button",9),l.Cc(19," submit "),l.Rb(),l.Rb(),l.Rb()),2&t&&(l.Ab(7),l.kc("formGroup",e.form),l.Ab(5),l.kc("formGroup",e.filter),l.Ab(2),l.kc("ngForOf",l.hc(15,4,l.hc(16,7,e.stores.data,"description"),l.mc(10,C,e.filter.value.store))),l.Ab(3),l.kc("ngIf",e.errors.storeId))},directives:[h.a,u.f,f.a,p.a,g.a,c.u,c.n,c.g,u.c,v.a,c.m,c.e,I.k,S.a,w.l,w.m,u.b],pipes:[R.a,k.a],styles:[".filter-dialog{width:500px!important}.filter-dialog .mat-dialog-container{padding:0!important}@media screen and (max-width:600px){.filter-dialog .mat-dialog-container{top:0;left:0;right:0;bottom:0;z-index:5000;position:fixed;border-radius:0}}"],encapsulation:2}),t})();var M=i("9ZKQ"),D=i("u0tM"),j=i("swrf"),F=i("bS1C"),G=i("tyNb"),N=i("G0b6"),E=i("BhS5"),q=i("WF9o"),x=i("bv9b"),H=i("A5z7");function P(t,e){1&t&&l.Nb(0,"mat-progress-bar",10)}function $(t,e){if(1&t){const t=l.Tb();l.Sb(0,"mat-chip",13),l.ac("removed",(function(){l.rc(t);const i=e.$implicit;return l.ec(2).unfilter("storeId",i)})),l.Sb(1,"mat-icon"),l.Cc(2," store "),l.Rb(),l.Sb(3,"mat-label"),l.Cc(4),l.Rb(),l.Sb(5,"mat-icon",14),l.Cc(6," cancel "),l.Rb(),l.Rb()}if(2&t){const t=e.$implicit,i=l.ec(2);l.Ab(4),l.Ec(" ",i.describe(i.stores.data,"storeId",t)," ")}}function B(t,e){if(1&t&&(l.Sb(0,"mat-chip-list",11),l.Ac(1,$,7,1,"mat-chip",12),l.Rb()),2&t){const t=l.ec();l.Ab(1),l.kc("ngForOf",t.filter.storeId)}}function J(t,e){1&t&&(l.Sb(0,"th",15),l.Cc(1," Description "),l.Rb())}function L(t,e){if(1&t&&(l.Sb(0,"td",16),l.Cc(1),l.Rb()),2&t){const t=e.$implicit;l.Ab(1),l.Ec(" ",t.description," ")}}function Q(t,e){1&t&&l.Nb(0,"th",17)}function T(t,e){if(1&t){const t=l.Tb();l.Sb(0,"td",16),l.Sb(1,"button",18),l.ac("click",(function(){l.rc(t);const i=e.$implicit;return l.ec().options(i)})),l.Sb(2,"mat-icon"),l.Cc(3," more_vert "),l.Rb(),l.Rb(),l.Rb()}}function V(t,e){1&t&&l.Nb(0,"tr",19)}function Z(t,e){1&t&&l.Nb(0,"tr",20)}let K=(()=>{class t{constructor(t,e,i,r,s,o,n,c,d,l){this.toast=t,this.dialog=e,this.sheet=i,this.stores=r,this.confirm=s,this.filters=o,this.router=n,this.service=c,this.buttons=d,this.localstorage=l,this.filter=this.filters.get({storeId:[]}),this.columns=["description","options"],this.departments=new a.o,this.subscriptions={}}list(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({sort:{description:1},filter:["role","departmentId","description"],storeId:this.filter.storeId});this.departments.data=t.ok?t.result.map(t=>new n.a(t)):[],this.loading=!1}))}load(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({filter:["storeId","description"]});this.stores.data=t.ok?t.result.map(t=>new s.a(t)):[],this.loading=!1}))}unfilter(t,e){this.filter[t]=this.filter[t].filter(t=>t!=e),this.filters.update(this.filter),this.list()}options(t){return Object(r.a)(this,void 0,void 0,(function*(){this.sheet.show({role:t.role,title:t.description,options:[{icon:"edit",title:"Edit department",handler:()=>{this.router.navigate(["/departments","editor"],{queryParams:{mode:"update",departmentId:t.departmentId}})},disabled:[0,1]},{icon:"delete",title:"Delete",danger:!0,handler:()=>{this.confirm.show({message:"Delete "+t.description,handler:()=>Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.service.delete({departmentId:t.departmentId});if(e.ok){for(let e=0;e<this.departments.data.length;e++)if(this.departments.data[e].departmentId==t.departmentId){this.departments.data.splice(e,1);break}this.departments.data=this.departments.data.map(t=>new n.a(t)),this.toast.success("department was removed!")}else this.toast.error(e.error.message);this.loading=!1}))})},disabled:[0,1]}]})}))}describe(t,e,i){let r="-";return t.map(t=>{t[e]==i&&(r=t.description)}),r}ngOnInit(){this.buttons.show("add"),this.buttons.hide("close"),this.buttons.show("filter"),this.buttons.show("search"),this.sort.active="description",this.sort.direction="desc",this.departments.sort=this.sort,this.subscriptions.add=this.buttons.add.click.subscribe(t=>{this.router.navigate(["/departments","editor"],{queryParams:{mode:"add"}})}),this.subscriptions.filter=this.buttons.filter.click.subscribe(t=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.dialog.open(O,{data:this.filter,panelClass:"filter-dialog"});yield t.afterClosed().subscribe(t=>Object(r.a)(this,void 0,void 0,(function*(){t&&(Object.keys(t).map(e=>{this.filter[e]=t[e]}),this.filters.update(this.filter),this.list())})))}))),this.subscriptions.search=this.buttons.search.value.subscribe(t=>{this.departments.filter=t}),(()=>{Object(r.a)(this,void 0,void 0,(function*(){yield this.list(),yield this.load()}))})()}ngOnDestroy(){this.buttons.reset("search"),this.subscriptions.add.unsubscribe(),this.subscriptions.filter.unsubscribe(),this.subscriptions.search.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(l.Mb(M.a),l.Mb(d.b),l.Mb(D.a),l.Mb(b.a),l.Mb(j.a),l.Mb(F.a),l.Mb(G.b),l.Mb(N.a),l.Mb(E.a),l.Mb(q.a))},t.\u0275cmp=l.Gb({type:t,selectors:[["departments-page"]],viewQuery:function(t,e){var i;1&t&&l.wc(o.a,!0),2&t&&l.oc(i=l.bc())&&(e.sort=i.first)},decls:12,vars:6,consts:[["mode","indeterminate",4,"ngIf"],["class","filterbar",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","description"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","options"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mode","indeterminate"],[1,"filterbar"],[3,"removed",4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(l.Sb(0,"mat-content"),l.Ac(1,P,1,0,"mat-progress-bar",0),l.Ac(2,B,2,1,"mat-chip-list",1),l.Sb(3,"table",2),l.Qb(4,3),l.Ac(5,J,2,0,"th",4),l.Ac(6,L,2,1,"td",5),l.Pb(),l.Qb(7,6),l.Ac(8,Q,1,0,"th",7),l.Ac(9,T,4,0,"td",5),l.Pb(),l.Ac(10,V,1,0,"tr",8),l.Ac(11,Z,1,0,"tr",9),l.Rb(),l.Rb()),2&t&&(l.Ab(1),l.kc("ngIf",e.loading),l.Ab(1),l.kc("ngIf",e.filter.storeId.length>0),l.Ab(1),l.kc("dataSource",e.departments),l.Ab(7),l.kc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),l.Ab(1),l.kc("matRowDefColumns",e.columns))},directives:[g.a,w.m,a.n,o.a,a.c,a.i,a.b,a.k,a.m,x.a,H.c,w.l,H.a,p.a,u.f,H.d,a.h,o.b,a.a,f.a,a.j,a.l],styles:[""]}),t})();var W=i("qFsG"),z=i("ZRfb");function X(t,e){1&t&&l.Nb(0,"mat-progress-bar",13)}function Y(t,e){if(1&t&&(l.Sb(0,"mat-option",14),l.Cc(1),l.Rb()),2&t){const t=e.$implicit;l.kc("value",t.storeId)("disabled",t.role<2),l.Ab(1),l.Ec(" ",t.description," ")}}function U(t,e){if(1&t&&(l.Sb(0,"mat-error"),l.Cc(1),l.Rb()),2&t){const t=l.ec();l.Ab(1),l.Ec(" ",t.errors.storeId," ")}}function _(t,e){if(1&t&&(l.Sb(0,"mat-error"),l.Cc(1),l.Rb()),2&t){const t=l.ec();l.Ab(1),l.Ec(" ",t.errors.description," ")}}const tt=function(t){return{description:t}};let et=(()=>{class t{constructor(t,e,i,r,s,o,a){this.toast=t,this.route=e,this.stores=i,this.router=r,this.service=s,this.buttons=o,this.formerror=a,this.form=new c.f({storeId:new c.c(null,[c.t.required]),description:new c.c(null,[c.t.required])}),this.errors={storeId:"",description:""},this.filter=new c.f({store:new c.c(null,[c.t.required])}),this.department=new n.a,this.subscriptions={}}get(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["role","storeId","description"],departmentId:this.departmentId});t.ok?(this.department=new n.a(t.result),this.department.role>2?(this.form.controls.storeId.setValue(this.department.storeId),this.form.controls.description.setValue(this.department.description)):(this.toast.error("Your role is not high enough to copy/edit this department!"),this.router.navigate(["/departments"]))):(this.toast.error(t.error.message),this.router.navigate(["/departments"])),this.loading=!1}))}load(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({sort:{description:1},filter:["storeId","description"]});t.ok?this.stores.data=t.result.map(t=>new s.a(t)):(this.stores.data=[],this.toast.error(t.error.message)),this.loading=!1}))}submit(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add",delete this.departmentId);const e=yield this.service[t]({storeId:this.form.value.storeId,description:this.form.value.description,departmentId:this.departmentId});e.ok?this.router.navigate(["/departments"]):this.toast.error(e.error.message),this.loading=!1}))}ngOnInit(){this.buttons.hide("add"),this.buttons.show("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.subscriptions.close=this.buttons.close.click.subscribe(t=>{this.router.navigate(["/departments"])});const t=this.route.snapshot.queryParams;this.mode=t.mode,this.departmentId=t.departmentId,(()=>{Object(r.a)(this,void 0,void 0,(function*(){"add"!=this.mode&&(yield this.get()),yield this.load()}))})()}ngOnDestroy(){this.subscriptions.form.unsubscribe(),this.subscriptions.close.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(l.Mb(M.a),l.Mb(G.a),l.Mb(b.a),l.Mb(G.b),l.Mb(N.a),l.Mb(E.a),l.Mb(m.a))},t.\u0275cmp=l.Gb({type:t,selectors:[["departments-editor-page"]],decls:24,vars:14,consts:[["mode","indeterminate",4,"ngIf"],[1,"container"],[3,"formGroup","ngSubmit"],["appearance","outline"],["name","storeId","formControlName","storeId","required",""],[3,"formGroup"],["placeholderLabel","filter stores","noEntriesFoundLabel","no stores found","formControlName","store"],[3,"value","disabled",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],["type","submit",2,"display","none"],["button",""],["type","button","color","primary","mat-flat-button","",3,"click"],["mode","indeterminate"],[3,"value","disabled"]],template:function(t,e){if(1&t){const t=l.Tb();l.Sb(0,"mat-content"),l.Ac(1,X,1,0,"mat-progress-bar",0),l.Sb(2,"div",1),l.Sb(3,"form",2),l.ac("ngSubmit",(function(){return!e.form.invalid&&!e.loading&&e.submit()})),l.Sb(4,"mat-form-field",3),l.Sb(5,"mat-label"),l.Cc(6," Store "),l.Rb(),l.Sb(7,"mat-select",4),l.Sb(8,"mat-option",5),l.Nb(9,"ngx-mat-select-search",6),l.Rb(),l.Ac(10,Y,2,3,"mat-option",7),l.fc(11,"filterBy"),l.fc(12,"orderBy"),l.Rb(),l.Ac(13,U,2,1,"mat-error",8),l.Rb(),l.Sb(14,"mat-form-field",3),l.Sb(15,"mat-label"),l.Cc(16," Description "),l.Rb(),l.Nb(17,"input",9),l.Ac(18,_,2,1,"mat-error",8),l.Rb(),l.Nb(19,"button",10,11),l.Rb(),l.Rb(),l.Rb(),l.Sb(21,"mat-footer"),l.Sb(22,"button",12),l.ac("click",(function(){return l.rc(t),l.pc(20).click()})),l.Cc(23," submit "),l.Rb(),l.Rb()}2&t&&(l.Ab(1),l.kc("ngIf",e.loading),l.Ab(2),l.kc("formGroup",e.form),l.Ab(5),l.kc("formGroup",e.filter),l.Ab(2),l.kc("ngForOf",l.hc(11,6,l.hc(12,9,e.stores.data,"description"),l.mc(12,tt,e.filter.value.store))),l.Ab(3),l.kc("ngIf",e.errors.storeId),l.Ab(5),l.kc("ngIf",e.errors.description))},directives:[g.a,w.m,c.u,c.n,c.g,u.c,u.f,v.a,c.m,c.e,c.s,I.k,S.a,w.l,W.a,c.b,z.a,f.a,x.a,u.b],pipes:[R.a,k.a],styles:[""]}),t})();var it=i("5Yg0"),rt=i("gyTc"),st=i("R32p"),ot=i("tVzd"),nt=i("J89Z"),at=i("p/0r"),ct=i("H0Zp");const dt=[{path:"",component:K},{path:"editor",component:et}];let lt=(()=>{class t{}return t.\u0275mod=l.Kb({type:t}),t.\u0275inj=l.Jb({factory:function(e){return new(e||t)},imports:[[c.i,w.c,it.a,st.a,o.c,o.c,rt.a,p.b,a.p,W.b,H.e,I.p,f.b,v.b,ot.a,nt.a,h.b,at.a,ct.a,u.e,c.r,x.b,S.b,G.e.forChild(dt)]]}),t})()}}]);