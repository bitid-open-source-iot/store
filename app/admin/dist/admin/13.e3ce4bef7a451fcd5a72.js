(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{SUx8:function(t,e,s){"use strict";s.r(e),s.d(e,"CustomersPageModule",(function(){return bt}));var i=s("mrSG"),o=s("o3Q1"),r=s("Dh3D");class a{constructor(t){void 0!==t&&null!=t&&(void 0!==t.role&&null!=t.role&&(this.role=t.role),void 0!==t.email&&null!=t.email&&(this.email=t.email),void 0!==t.status&&null!=t.status&&(this.status=t.status),void 0!==t.storeId&&null!=t.storeId&&(this.storeId=t.storeId),void 0!==t.customerId&&null!=t.customerId&&(this.customerId=t.customerId))}}var c=s("+0xr"),n=s("3Pt+"),l=s("0IaG"),d=s("fXoL"),u=s("btHx"),b=s("dWDE"),m=s("/t3+"),h=s("kmnG"),f=s("bTqV"),p=s("NFeN"),g=s("4jEk"),v=s("d3UM"),I=s("FKr1"),S=s("WJ5W"),w=s("ofXK"),R=s("AbOq"),y=s("roMP");function k(t,e){if(1&t&&(d.Sb(0,"mat-option",10),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.storeId),d.Ab(1),d.Ec(" ",t.description," ")}}function C(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.storeId," ")}}const A=function(t){return{description:t}};let O=(()=>{class t{constructor(t,e,s,i){this.dialog=t,this.config=e,this.stores=s,this.formerror=i,this.form=new n.f({storeId:new n.c([])}),this.filter=new n.f({store:new n.c("")}),this.errors={storeId:""},this.subscriptions={}}load(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({filter:["storeId","description"]});this.stores.data=t.ok?t.result.map(t=>new o.a(t)):[],void 0!==this.config.storeId&&null!=this.config.storeId&&this.form.controls.storeId.setValue(this.config.storeId),this.loading=!1}))}close(){return Object(i.a)(this,void 0,void 0,(function*(){this.dialog.close(!1)}))}submit(){return Object(i.a)(this,void 0,void 0,(function*(){this.dialog.close(this.form.value)}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.load()}ngOnDestroy(){this.subscriptions.form.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(l.d),d.Mb(l.a),d.Mb(u.a),d.Mb(b.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["customers-filter-dialog"]],decls:20,vars:12,consts:[[1,"spacer"],["mat-icon-button","",3,"click"],[3,"formGroup","ngSubmit"],["appearance","outline"],["name","storeId","formControlName","storeId","multiple",""],[3,"formGroup"],["placeholderLabel","filter stores","noEntriesFoundLabel","no stores found","formControlName","store"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","submit","color","primary","mat-flat-button",""],[3,"value"]],template:function(t,e){1&t&&(d.Sb(0,"mat-toolbar"),d.Sb(1,"mat-label",0),d.Cc(2," Filter Customers "),d.Rb(),d.Sb(3,"button",1),d.ac("click",(function(){return e.close()})),d.Sb(4,"mat-icon"),d.Cc(5," close "),d.Rb(),d.Rb(),d.Rb(),d.Sb(6,"mat-content"),d.Sb(7,"form",2),d.ac("ngSubmit",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),d.Sb(8,"mat-form-field",3),d.Sb(9,"mat-label"),d.Cc(10," Store(s) "),d.Rb(),d.Sb(11,"mat-select",4),d.Sb(12,"mat-option",5),d.Nb(13,"ngx-mat-select-search",6),d.Rb(),d.Ac(14,k,2,2,"mat-option",7),d.fc(15,"filterBy"),d.fc(16,"orderBy"),d.Rb(),d.Ac(17,C,2,1,"mat-error",8),d.Rb(),d.Sb(18,"button",9),d.Cc(19," submit "),d.Rb(),d.Rb(),d.Rb()),2&t&&(d.Ab(7),d.kc("formGroup",e.form),d.Ab(5),d.kc("formGroup",e.filter),d.Ab(2),d.kc("ngForOf",d.hc(15,4,d.hc(16,7,e.stores.data,"description"),d.mc(10,A,e.filter.value.store))),d.Ab(3),d.kc("ngIf",e.errors.storeId))},directives:[m.a,h.f,f.a,p.a,g.a,n.u,n.n,n.g,h.c,v.a,n.m,n.e,I.k,S.a,w.l,w.m,h.b],pipes:[R.a,y.a],styles:[".filter-dialog{width:500px!important}.filter-dialog .mat-dialog-container{padding:0!important}@media screen and (max-width:600px){.filter-dialog .mat-dialog-container{top:0;left:0;right:0;bottom:0;z-index:5000;position:fixed;border-radius:0}}"],encapsulation:2}),t})();var M=s("9ZKQ"),D=s("u0tM"),j=s("swrf"),F=s("tyNb"),N=s("bS1C"),x=s("ZK1m"),E=s("BhS5"),G=s("WF9o"),q=s("bv9b"),P=s("A5z7");function H(t,e){1&t&&d.Nb(0,"mat-progress-bar",11)}function $(t,e){if(1&t){const t=d.Tb();d.Sb(0,"mat-chip",14),d.ac("removed",(function(){d.rc(t);const s=e.$implicit;return d.ec(2).unfilter("storeId",s)})),d.Sb(1,"mat-icon"),d.Cc(2," store "),d.Rb(),d.Sb(3,"mat-label"),d.Cc(4),d.Rb(),d.Sb(5,"mat-icon",15),d.Cc(6," cancel "),d.Rb(),d.Rb()}if(2&t){const t=e.$implicit,s=d.ec(2);d.Ab(4),d.Ec(" ",s.describe(s.stores.data,"storeId",t)," ")}}function Q(t,e){if(1&t&&(d.Sb(0,"mat-chip-list",12),d.Ac(1,$,7,1,"mat-chip",13),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.kc("ngForOf",t.filter.storeId)}}function B(t,e){1&t&&(d.Sb(0,"th",16),d.Cc(1," Email "),d.Rb())}function J(t,e){if(1&t&&(d.Sb(0,"td",17),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.Ab(1),d.Ec(" ",t.email," ")}}function K(t,e){1&t&&(d.Sb(0,"th",16),d.Cc(1," Status "),d.Rb())}function L(t,e){if(1&t&&(d.Sb(0,"td",17),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.Ab(1),d.Ec(" ",t.status," ")}}function T(t,e){1&t&&d.Nb(0,"th",18)}function V(t,e){if(1&t){const t=d.Tb();d.Sb(0,"td",17),d.Sb(1,"button",19),d.ac("click",(function(){d.rc(t);const s=e.$implicit;return d.ec().options(s)})),d.Sb(2,"mat-icon"),d.Cc(3," more_vert "),d.Rb(),d.Rb(),d.Rb()}}function Z(t,e){1&t&&d.Nb(0,"tr",20)}function W(t,e){1&t&&d.Nb(0,"tr",21)}let z=(()=>{class t{constructor(t,e,s,i,o,r,a,n,l,d){this.toast=t,this.dialog=e,this.sheet=s,this.stores=i,this.confirm=o,this.router=r,this.filters=a,this.service=n,this.buttons=l,this.localstorage=d,this.filter=this.filters.get({storeId:[]}),this.columns=["email","status","options"],this.customers=new c.o,this.subscriptions={}}list(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({sort:{description:1},filter:["role","email","status","customerId"],storeId:this.filter.storeId});this.customers.data=t.ok?t.result.map(t=>new a(t)):[],this.loading=!1}))}load(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({filter:["storeId","description"]});this.stores.data=t.ok?t.result.map(t=>new o.a(t)):[],this.loading=!1}))}unfilter(t,e){this.filter[t]=this.filter[t].filter(t=>t!=e),this.filters.update(this.filter),this.list()}options(t){return Object(i.a)(this,void 0,void 0,(function*(){let e=[{icon:"edit",title:"Edit Customer",handler:()=>{this.router.navigate(["/customers","editor"],{queryParams:{mode:"update",customerId:t.customerId}})},disabled:[0,1]},{icon:"delete",title:"Delete",danger:!0,handler:()=>{this.confirm.show({message:"Delete "+t.email,handler:()=>Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.service.delete({customerId:t.customerId});if(e.ok){for(let e=0;e<this.customers.data.length;e++)if(this.customers.data[e].customerId==t.customerId){this.customers.data.splice(e,1);break}this.customers.data=this.customers.data.map(t=>new a(t)),this.toast.success("Customer was removed!")}else this.toast.error(e.error.message);this.loading=!1}))})},disabled:[0,1]}];"requested"==t.status&&e.unshift({icon:"done",title:"Accept Customer",handler:()=>Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.service.update({status:"accepted",storeId:t.storeId,customerId:t.customerId});e.ok?t.status="accepted":this.toast.error(e.error.message),this.loading=!1})),disabled:[0,1]}),this.sheet.show({role:t.role,title:t.email,options:e})}))}describe(t,e,s){let i="-";return t.map(t=>{t[e]==s&&(i=t.description)}),i}ngOnInit(){this.buttons.show("add"),this.buttons.hide("close"),this.buttons.show("filter"),this.buttons.show("search"),this.sort.active="description",this.sort.direction="desc",this.customers.sort=this.sort,this.subscriptions.add=this.buttons.add.click.subscribe(t=>{this.router.navigate(["/customers","editor"],{queryParams:{mode:"add"}})}),this.subscriptions.filter=this.buttons.filter.click.subscribe(t=>Object(i.a)(this,void 0,void 0,(function*(){const t=yield this.dialog.open(O,{data:this.filter,panelClass:"filter-dialog"});yield t.afterClosed().subscribe(t=>Object(i.a)(this,void 0,void 0,(function*(){t&&(Object.keys(t).map(e=>{this.filter[e]=t[e]}),this.filters.update(this.filter),this.list())})))}))),this.subscriptions.search=this.buttons.search.value.subscribe(t=>{this.customers.filter=t}),(()=>{Object(i.a)(this,void 0,void 0,(function*(){yield this.list(),yield this.load()}))})()}ngOnDestroy(){this.buttons.reset("search"),this.subscriptions.add.unsubscribe(),this.subscriptions.filter.unsubscribe(),this.subscriptions.search.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(M.a),d.Mb(l.b),d.Mb(D.a),d.Mb(u.a),d.Mb(j.a),d.Mb(F.b),d.Mb(N.a),d.Mb(x.a),d.Mb(E.a),d.Mb(G.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["customers-page"]],viewQuery:function(t,e){var s;1&t&&d.wc(r.a,!0),2&t&&d.oc(s=d.bc())&&(e.sort=s.first)},decls:15,vars:6,consts:[["mode","indeterminate",4,"ngIf"],["class","filterbar",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","email"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","options"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mode","indeterminate"],[1,"filterbar"],[3,"removed",4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(d.Sb(0,"mat-content"),d.Ac(1,H,1,0,"mat-progress-bar",0),d.Ac(2,Q,2,1,"mat-chip-list",1),d.Sb(3,"table",2),d.Qb(4,3),d.Ac(5,B,2,0,"th",4),d.Ac(6,J,2,1,"td",5),d.Pb(),d.Qb(7,6),d.Ac(8,K,2,0,"th",4),d.Ac(9,L,2,1,"td",5),d.Pb(),d.Qb(10,7),d.Ac(11,T,1,0,"th",8),d.Ac(12,V,4,0,"td",5),d.Pb(),d.Ac(13,Z,1,0,"tr",9),d.Ac(14,W,1,0,"tr",10),d.Rb(),d.Rb()),2&t&&(d.Ab(1),d.kc("ngIf",e.loading),d.Ab(1),d.kc("ngIf",e.filter.storeId.length>0),d.Ab(1),d.kc("dataSource",e.customers),d.Ab(10),d.kc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),d.Ab(1),d.kc("matRowDefColumns",e.columns))},directives:[g.a,w.m,c.n,r.a,c.c,c.i,c.b,c.k,c.m,q.a,P.c,w.l,P.a,p.a,h.f,P.d,c.h,r.b,c.a,f.a,c.j,c.l],styles:[""]}),t})();var U=s("qFsG"),X=s("ZRfb");function Y(t,e){1&t&&d.Nb(0,"mat-progress-bar",13)}function _(t,e){if(1&t&&(d.Sb(0,"mat-option",14),d.Cc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.storeId)("disabled",t.role<2),d.Ab(1),d.Ec(" ",t.description," ")}}function tt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.storeId," ")}}function et(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Cc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Ec(" ",t.errors.email," ")}}const st=function(t){return{description:t}};let it=(()=>{class t{constructor(t,e,s,i,o,r,c){this.toast=t,this.route=e,this.stores=s,this.router=i,this.service=o,this.buttons=r,this.formerror=c,this.form=new n.f({email:new n.c(null,[n.t.required]),storeId:new n.c(null,[n.t.required])}),this.errors={email:"",storeId:""},this.filter=new n.f({store:new n.c(null,[n.t.required])}),this.customer=new a,this.subscriptions={}}get(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["role","email","storeId"],customerId:this.customerId});t.ok?(this.customer=new a(t.result),this.customer.role>2?(this.form.controls.email.setValue(this.customer.email),this.form.controls.storeId.setValue(this.customer.storeId)):(this.toast.error("Your role is not high enough to copy/edit this customer!"),this.router.navigate(["/customers"]))):(this.toast.error(t.error.message),this.router.navigate(["/customers"])),this.loading=!1}))}load(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.stores.list({sort:{description:1},filter:["storeId","description"]});t.ok?this.stores.data=t.result.map(t=>new o.a(t)):(this.stores.data=[],this.toast.error(t.error.message)),this.loading=!1}))}submit(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add",delete this.customerId);const e=yield this.service[t]({email:this.form.value.email,storeId:this.form.value.storeId,customerId:this.customerId});e.ok?this.router.navigate(["/customers"]):this.toast.error(e.error.message),this.loading=!1}))}ngOnInit(){this.buttons.hide("add"),this.buttons.show("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.subscriptions.close=this.buttons.close.click.subscribe(t=>{this.router.navigate(["/customers"])});const t=this.route.snapshot.queryParams;this.mode=t.mode,this.customerId=t.customerId,(()=>{Object(i.a)(this,void 0,void 0,(function*(){"add"!=this.mode&&(yield this.get()),yield this.load()}))})()}ngOnDestroy(){this.subscriptions.form.unsubscribe(),this.subscriptions.close.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(M.a),d.Mb(F.a),d.Mb(u.a),d.Mb(F.b),d.Mb(x.a),d.Mb(E.a),d.Mb(b.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["customers-editor-page"]],decls:24,vars:14,consts:[["mode","indeterminate",4,"ngIf"],[1,"container"],[3,"formGroup","ngSubmit"],["appearance","outline"],["name","storeId","formControlName","storeId","required",""],[3,"formGroup"],["placeholderLabel","filter stores","noEntriesFoundLabel","no stores found","formControlName","store"],[3,"value","disabled",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","type","email","name","email","placeholder","email","formControlName","email","required",""],["type","submit",2,"display","none"],["button",""],["type","button","color","primary","mat-flat-button","",3,"click"],["mode","indeterminate"],[3,"value","disabled"]],template:function(t,e){if(1&t){const t=d.Tb();d.Sb(0,"mat-content"),d.Ac(1,Y,1,0,"mat-progress-bar",0),d.Sb(2,"div",1),d.Sb(3,"form",2),d.ac("ngSubmit",(function(){return!e.form.invalid&&!e.loading&&e.submit()})),d.Sb(4,"mat-form-field",3),d.Sb(5,"mat-label"),d.Cc(6," Store "),d.Rb(),d.Sb(7,"mat-select",4),d.Sb(8,"mat-option",5),d.Nb(9,"ngx-mat-select-search",6),d.Rb(),d.Ac(10,_,2,3,"mat-option",7),d.fc(11,"filterBy"),d.fc(12,"orderBy"),d.Rb(),d.Ac(13,tt,2,1,"mat-error",8),d.Rb(),d.Sb(14,"mat-form-field",3),d.Sb(15,"mat-label"),d.Cc(16," Email "),d.Rb(),d.Nb(17,"input",9),d.Ac(18,et,2,1,"mat-error",8),d.Rb(),d.Nb(19,"button",10,11),d.Rb(),d.Rb(),d.Rb(),d.Sb(21,"mat-footer"),d.Sb(22,"button",12),d.ac("click",(function(){return d.rc(t),d.pc(20).click()})),d.Cc(23," submit "),d.Rb(),d.Rb()}2&t&&(d.Ab(1),d.kc("ngIf",e.loading),d.Ab(2),d.kc("formGroup",e.form),d.Ab(5),d.kc("formGroup",e.filter),d.Ab(2),d.kc("ngForOf",d.hc(11,6,d.hc(12,9,e.stores.data,"description"),d.mc(12,st,e.filter.value.store))),d.Ab(3),d.kc("ngIf",e.errors.storeId),d.Ab(5),d.kc("ngIf",e.errors.email))},directives:[g.a,w.m,n.u,n.n,n.g,h.c,h.f,v.a,n.m,n.e,n.s,I.k,S.a,w.l,U.a,n.b,X.a,f.a,q.a,h.b],pipes:[R.a,y.a],styles:[".logo[_ngcontent-%COMP%]{width:150px;height:150px;border:1px solid #e0e0e0;display:flex;margin:20px auto auto;align-items:center;border-radius:5px;justify-content:center;background-color:#fafafa}"]}),t})();var ot=s("5Yg0"),rt=s("gyTc"),at=s("R32p"),ct=s("tVzd"),nt=s("J89Z"),lt=s("p/0r"),dt=s("H0Zp");const ut=[{path:"",component:z},{path:"editor",component:it}];let bt=(()=>{class t{}return t.\u0275mod=d.Kb({type:t}),t.\u0275inj=d.Jb({factory:function(e){return new(e||t)},imports:[[n.i,w.c,ot.a,at.a,r.c,r.c,rt.a,p.b,c.p,P.e,U.b,l.c,I.p,f.b,v.b,ct.a,nt.a,m.b,lt.a,dt.a,h.e,n.r,q.b,S.b,F.e.forChild(ut)]]}),t})()}}]);